<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Olimpiyat KokoreÃ§ MenÃ¼</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <style>
    body { background-color: #fff7f0; }
    .active-tab { background-color: #fb923c; color: white; }
    #categoryTabs::-webkit-scrollbar { display: none; }
    #categoryTabs { -ms-overflow-style: none; scrollbar-width: none; }
    /* Tarih bilgisini saÄŸ altta ve kÃ¼Ã§Ã¼k tutar */
    .price-update-info { font-size: 0.7rem; color: #6b7280; margin-top: 5px; } 
  </style>
</head>
<body class="text-gray-800">
  
  <div id="viewCountListener" style="display:none;"></div> 

  <header class="bg-orange-500 text-white p-4 flex justify-between items-center sticky top-0 z-10 shadow-md">
    <h1 class="text-2xl font-bold">Olimpiyat KokoreÃ§</h1>
    <div class="flex items-center gap-2">
      <button id="langTR" class="bg-white text-orange-600 px-3 py-1 rounded font-bold">TR</button>
      <button id="langEN" class="bg-white text-orange-600 px-3 py-1 rounded">EN</button>
      <button id="adminLoginBtn" class="bg-white text-orange-600 px-3 py-1 rounded">âš™ï¸ YÃ¶netici GiriÅŸi</button>
    </div>
  </header>

  <nav id="categoryTabs" class="flex overflow-x-auto bg-white shadow p-2 space-x-2 text-sm font-semibold sticky top-[64px] z-10"></nav>

  <main class="p-4">
    <div id="menuContainer" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <div id="contactSection" class="hidden text-center mt-6 bg-white rounded-xl shadow p-6 max-w-lg mx-auto">
      <h2 id="contactTitle" class="text-2xl font-bold text-orange-600 mb-3">Ä°letiÅŸim</h2>
      <p id="contactAddress" class="mb-3">ğŸ“ Yamanevler Mah. AlemdaÄŸ Caddesi No 159 D<br>Olimpiyat KokoreÃ§ Ãœmraniye - Ä°stanbul</p>
      <p class="mt-2">ğŸ“ <a href="tel:02163357920" id="contactPhone" class="text-orange-600 font-semibold text-lg hover:underline">0216 335 79 20</a></p>
    </div>
  </main>

  <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 transition-opacity">
    <img id="modalImage" class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl transition-transform">
  </div>

  <div id="adminLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-96 relative">
      <button id="closeAdminLogin" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">âœ–</button>
      <h2 class="text-xl font-bold mb-3 text-orange-600">YÃ¶netici GiriÅŸi</h2>
      <input id="passwordInput" type="password" placeholder="Åifreyi giriniz" class="border w-full p-2 rounded mb-3 focus:ring-orange-500 focus:border-orange-500" />
      <button id="checkPassword" class="bg-orange-500 text-white px-4 py-2 rounded w-full hover:bg-orange-600 transition">GiriÅŸ Yap</button>
      <p id="loginError" class="text-red-600 text-sm mt-2 hidden">HatalÄ± ÅŸifre!</p>
    </div>
  </div>

  <script>
    // --- Firebase YapÄ±landÄ±rmasÄ± (DÃœZELTÄ°LMÄ°Å URL) ---
    const firebaseConfig = {
        apiKey: "AIzaSyDcYNF0hMow-y1MuV3GXLG9vY_MK0tJTGs",
        authDomain: "olimpiyatkokorecmenu.firebaseapp.com",
        projectId: "olimpiyatkokorecmenu",
        messagingSenderId: "987017604417",
        appId: "1:987017604417:web:b6c4858712dc66d14745c0",
        measurementId: "G-HB0J7BFZ9N",
        // BÃ¶lgesel uyarÄ±yÄ± Ã§Ã¶zen URL
        databaseURL: "https://olimpiyatkokorecmenu-default-rtdb.europe-west1.firebaseio.com" 
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const productsRef = database.ref('products');
    const visitorsRef = database.ref('visitors'); 

    // --- HTML Element TanÄ±mlamalarÄ± ---
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLoginModal = document.getElementById('adminLoginModal');
    const checkPassword = document.getElementById('checkPassword');
    const passwordInput = document.getElementById('passwordInput');
    const loginError = document.getElementById('loginError');
    const closeAdminLogin = document.getElementById('closeAdminLogin');
    const menuContainer = document.getElementById('menuContainer');
    const contactSection = document.getElementById('contactSection');
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const langTR = document.getElementById('langTR');
    const langEN = document.getElementById('langEN');
    const contactTitle = document.getElementById('contactTitle');
    const contactAddress = document.getElementById('contactAddress');
    const tabButtonsContainer = document.getElementById('categoryTabs');
    const viewCountListener = document.getElementById('viewCountListener');

    let language = 'TR'; 
    let products = []; 

    // Kategori Ã§evirileri
    const categoryTranslations = {
      'TÃ¼mÃ¼': 'All', 'MenÃ¼ler': 'Menus', 'KokoreÃ§': 'KokoreÃ§', 'Tavuk DÃ¶ner': 'Chicken DÃ¶ner',
      'KÃ¶fte': 'Meatballs', 'CiÄŸer': 'Liver', 'Hamburger': 'Hamburger',
      'Yan Lezzetler': 'Side Dishes', 'Ä°Ã§ecekler': 'Drinks', 'Ä°letiÅŸim': 'Contact'
    };
    let categoriesTR = Object.keys(categoryTranslations);
    let categoriesEN = Object.values(categoryTranslations);

    // --- YENÄ° VE GÃœNCELLENMÄ°Å ZAMAN VE TARÄ°H YARDIMCI FONKSÄ°YONU ---

    /**
     * Unix zaman damgasÄ±nÄ± alarak istenilen gÃ¶receli bir tarih metni dÃ¶ndÃ¼rÃ¼r (1 dakika Ã¶nce, 2 saat Ã¶nce, 1 gÃ¼n Ã¶nce, vb.).
     * @param {number} timestamp - Unix zaman damgasÄ± (miliseconds)
     * @returns {string} GÃ¶receli tarih metni
     */
    function formatRelativeDate(timestamp) {
        if (!timestamp) return "";
        
        const now = Date.now();
        const diffTime = now - timestamp; // Fark milisaniye cinsinden

        const diffSeconds = Math.floor(diffTime / 1000);
        const diffMinutes = Math.floor(diffSeconds / 60);
        const diffHours = Math.floor(diffMinutes / 60);
        const diffDays = Math.floor(diffHours / 24);

        const TR = {
            min: (m) => `${m} dakika Ã¶nce`,
            hour: (h) => `${h} saat Ã¶nce`,
            day: (d) => `${d} gÃ¼n Ã¶nce`,
            today: 'BugÃ¼n',
            yesterday: 'DÃ¼n',
            week: '1 hafta Ã¶nce',
            date: (d, m, y) => `${d}.${m}.${y}`
        };

        const EN = {
            min: (m) => `${m} minutes ago`,
            hour: (h) => `${h} hours ago`,
            day: (d) => `${d} days ago`,
            today: 'Today',
            yesterday: 'Yesterday',
            week: '1 week ago',
            date: (d, m, y) => `${d}/${m}/${y}`
        };

        const t = language === 'TR' ? TR : EN;

        if (diffMinutes < 60) {
            // 0 - 59 dakika aralÄ±ÄŸÄ±
            if (diffMinutes === 0) return t.today; 
            return t.min(diffMinutes);
        } else if (diffHours < 24) {
            // 1 saat - 23 saat aralÄ±ÄŸÄ±
            return t.hour(diffHours);
        } else if (diffDays === 1) {
            // 24 saat tamamlandÄ±ÄŸÄ±nda
             return t.day(1); // 1 gÃ¼n Ã¶nce
        } else if (diffDays <= 7) {
            // 2 gÃ¼n ile 7 gÃ¼n arasÄ±
            return t.day(diffDays); 
        } else if (diffDays <= 14) {
            // 1 hafta Ã¶ncesi
            return t.week;
        } else {
            // Tarih gÃ¶sterimi (gg.aa.yyyy veya mm/dd/yyyy)
            const date = new Date(timestamp);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return t.date(day, month, year);
        }
    }


    // --- FIREBASE VERÄ° Ä°ÅLEME ---

    function transformProducts(dataSnapshot) {
      const productsArray = [];
      dataSnapshot.forEach(childSnapshot => {
        const product = childSnapshot.val();
        product.key = childSnapshot.key;
        // lastUpdated alanÄ± yoksa, ÅŸu anki zamanÄ± varsayÄ±lan olarak atar.
        product.lastUpdated = product.lastUpdated || Date.now(); 
        productsArray.push(product);
      });
      return productsArray;
    }

    function setupFirebaseListener() {
        productsRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                products = transformProducts(snapshot);
            } else {
                products = [];
            }
            updateLanguageContent(); 
        }, (error) => {
            console.error("Firebase veri okuma hatasÄ±:", error);
            alert("MenÃ¼yÃ¼ yÃ¼klerken bir hata oluÅŸtu.");
        });
    }

    // --- ZÄ°YARETÃ‡Ä° SAYACI Ä°ÅLEVÄ° (Admin.html'den gelen ziyaretÃ§iyi sayar) ---

    function trackVisitor() {
        const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
        const counterRef = visitorsRef.child(today);
        
        counterRef.once('value', snapshot => {}); // Okuma dinleyicisi
        
        // Atomic increment (Mevcut deÄŸeri okumadan 1 arttÄ±rma)
        counterRef.transaction(currentCount => {
            return (currentCount || 0) + 1;
        });
    }


    // --- UI GÃœNCELLEMELERÄ° ---

    function renderMenu(category='TÃ¼mÃ¼'){
      menuContainer.innerHTML='';
      const filtered = category==='TÃ¼mÃ¼'?products:products.filter(p=>p.category===category);

      filtered.forEach(p=>{
        const card=document.createElement('div');
        card.className='bg-white rounded-xl shadow p-4 flex flex-col hover:shadow-lg transition-shadow duration-200';
        
        const name = language==='TR'?p.name:p.nameEN||p.name;
        const desc = language==='TR'?p.desc:p.descEN||p.desc||'';
        // YENÄ° GÃœNCELLENMÄ°Å TARÄ°H FORMATI KULLANILIYOR
        const priceUpdateText = formatRelativeDate(p.lastUpdated); 
        const lastUpdateLabel = language === 'TR' ? 'Fiyat gÃ¼ncellendi:' : 'Price updated:';


        card.innerHTML=`
          <img src='${p.image}' alt='${name}' class='w-full h-40 object-cover rounded-lg mb-3 cursor-pointer'>
          <h3 class='font-bold text-xl mb-1'>${name}</h3>
          <p class='text-gray-600 text-sm mb-3 flex-grow'>${desc}</p>
          <div class="flex justify-between items-end">
            <p class='bg-orange-100 text-orange-700 inline-block px-3 py-1 rounded-full font-bold text-lg self-start'>${p.price} â‚º</p>
            <p class='price-update-info text-right'>${lastUpdateLabel} ${priceUpdateText}</p>
          </div>
        `;
        card.querySelector('img').addEventListener('click',()=>{modalImage.src=p.image;imageModal.classList.remove('hidden');});
        menuContainer.appendChild(card);
      });
    }

    // (DiÄŸer UI ve Navigasyon fonksiyonlarÄ± aynÄ± kalÄ±r)
    function createCategoryTabs(){
        tabButtonsContainer.innerHTML = '';
        const categoriesToIterate = categoriesTR;

        categoriesToIterate.forEach((catTR, index) => {
            let btn = document.createElement('button');
            const catName = language === 'TR' ? catTR : categoriesEN[index];

            btn.className='tabBtn px-3 py-1 rounded whitespace-nowrap transition-colors duration-150 hover:bg-orange-200';
            btn.dataset.category=catTR;
            btn.textContent=catName;

            if(catTR==='TÃ¼mÃ¼') {
                btn.classList.add('active-tab');
            }

            btn.addEventListener('click',()=>{
                document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active-tab'));
                btn.classList.add('active-tab');
                const categoryKey = btn.dataset.category;

                if(categoryKey==='Ä°letiÅŸim'){
                    menuContainer.innerHTML='';
                    contactSection.classList.remove('hidden');
                } else {
                    contactSection.classList.add('hidden');
                    renderMenu(categoryKey);
                }
            });
            tabButtonsContainer.appendChild(btn);
        });
    }

    function updateLanguageContent() {
        if (language === 'TR') {
            adminLoginBtn.innerHTML = 'âš™ï¸ YÃ¶netici GiriÅŸi';
            contactTitle.textContent = 'Ä°letiÅŸim';
            contactAddress.innerHTML = 'ğŸ“ Yamanevler Mah. AlemdaÄŸ Caddesi No 159 D<br>Olimpiyat KokoreÃ§ Ãœmraniye - Ä°stanbul';
            langTR.style.fontWeight = 'bold';
            langEN.style.fontWeight = 'normal';
        } else { 
            adminLoginBtn.innerHTML = 'âš™ï¸ Admin Login';
            contactTitle.textContent = 'Contact';
            contactAddress.innerHTML = 'ğŸ“ Yamanevler Mah. AlemdaÄŸ Caddesi No 159 D<br>Olimpiyat KokoreÃ§ Ãœmraniye - Istanbul (Turkey)';
            langTR.style.fontWeight = 'normal';
            langEN.style.fontWeight = 'bold';
        }

        createCategoryTabs();
        const activeTab = document.querySelector('.tabBtn.active-tab');
        const activeCategoryKey = activeTab ? activeTab.dataset.category : 'TÃ¼mÃ¼';
        
        if (activeCategoryKey === 'Ä°letiÅŸim') {
            menuContainer.innerHTML = '';
            contactSection.classList.remove('hidden');
        } else {
            contactSection.classList.add('hidden');
            renderMenu(activeCategoryKey);
        }
    }


    // --- EVENT LISTENERS ---

    langTR.addEventListener('click',()=>{ language='TR'; updateLanguageContent(); });
    langEN.addEventListener('click',()=>{ language='EN'; updateLanguageContent(); });
    imageModal.addEventListener('click',()=>imageModal.classList.add('hidden'));
    adminLoginBtn.addEventListener('click',()=>adminLoginModal.classList.remove('hidden'));
    closeAdminLogin.addEventListener('click',()=>adminLoginModal.classList.add('hidden'));

    checkPassword.addEventListener('click',()=>{
      if(passwordInput.value==='admin123'){ 
        // BaÅŸarÄ±lÄ± giriÅŸ: YÃ¶netici paneli sayfasÄ±na yÃ¶nlendir
        adminLoginModal.classList.add('hidden');
        window.location.href = 'admin.html'; 
      } else {
        loginError.classList.remove('hidden');
      }
    });

    // --- Ä°lk YÃ¼kleme ---
    document.addEventListener('DOMContentLoaded', () => {
      setupFirebaseListener(); 
      trackVisitor(); // ZiyaretÃ§i sayacÄ±nÄ± Ã§alÄ±ÅŸtÄ±r
    });
  </script>
</body>
</html>
