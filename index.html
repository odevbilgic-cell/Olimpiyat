<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Olimpiyat Kokore√ß Men√º - Kullanƒ±cƒ± Aray√ºz√º</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <style>
    body { background-color: #fff7f0; }
    .active-tab { background-color: #fb923c; color: white; }
    #categoryTabs::-webkit-scrollbar { display: none; }
    #categoryTabs { -ms-overflow-style: none; scrollbar-width: none; }
    .price-update-info { font-size: 0.7rem; color: #6b7280; margin-top: 5px; }
  </style>
</head>
<body class="text-gray-800">
  
  <div id="viewCountListener" style="display:none;"></div> 

  <header class="bg-orange-500 text-white p-4 flex justify-between items-center sticky top-0 z-10 shadow-md">
    <h1 class="text-2xl font-bold">Olimpiyat Kokore√ß</h1>
    <div class="flex items-center gap-2">
      <button id="langTR" class="bg-white text-orange-600 px-3 py-1 rounded font-bold">TR</button>
      <button id="langEN" class="bg-white text-orange-600 px-3 py-1 rounded">EN</button>
      <button id="adminLoginBtn" class="bg-white text-orange-600 px-3 py-1 rounded">‚öôÔ∏è Y√∂netici Giri≈üi</button>
    </div>
  </header>

  <nav id="categoryTabs" class="flex overflow-x-auto bg-white shadow p-2 space-x-2 text-sm font-semibold sticky top-[64px] z-10"></nav>

  <main class="p-4">
    <div id="menuContainer" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <div id="contactSection" class="hidden text-center mt-6 bg-white rounded-xl shadow p-6 max-w-lg mx-auto">
      <h2 id="contactTitle" class="text-2xl font-bold text-orange-600 mb-3">ƒ∞leti≈üim</h2>
      <p id="contactAddress" class="mb-3">üìç Yamanevler Mah. Alemdaƒü Caddesi No 159 D<br>Olimpiyat Kokore√ß √úmraniye - ƒ∞stanbul</p>
      <p class="mt-2">üìû <a href="tel:02163357920" id="contactPhone" class="text-orange-600 font-semibold text-lg hover:underline">0216 335 79 20</a></p>
    </div>
  </main>

  <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 transition-opacity">
    <img id="modalImage" class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl transition-transform">
  </div>

  <div id="adminLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-96 relative">
      <button id="closeAdminLogin" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">‚úñ</button>
      <h2 class="text-xl font-bold mb-3 text-orange-600">Y√∂netici Giri≈üi</h2>
      <input id="passwordInput" type="password" placeholder="≈ûifreyi giriniz" class="border w-full p-2 rounded mb-3 focus:ring-orange-500 focus:border-orange-500" />
      <button id="checkPassword" class="bg-orange-500 text-white px-4 py-2 rounded w-full hover:bg-orange-600 transition">Giri≈ü Yap</button>
      <p id="loginError" class="text-red-600 text-sm mt-2 hidden">Hatalƒ± ≈üifre!</p>
    </div>
  </div>

  <script>
    // --- Firebase Yapƒ±landƒ±rmasƒ± ---
    const firebaseConfig = {
        apiKey: "AIzaSyDcYNF0hMow-y1MuV3GXLG9vY_MK0tJTGs",
        authDomain: "olimpiyatkokorecmenu.firebaseapp.com",
        projectId: "olimpiyatkokorecmenu",
        messagingSenderId: "987017604417",
        appId: "1:987017604417:web:b6c4858712dc66d14745c0",
        measurementId: "G-HB0J7BFZ9N",
        databaseURL: "https://olimpiyatkokorecmenu-default-rtdb.europe-west1.firebasedatabase.app"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const productsRef = database.ref('products');
    const visitorsRef = database.ref('visitors'); // Yeni ziyaret√ßi sayacƒ± referansƒ±

    // --- HTML Element Tanƒ±mlamalarƒ± ---
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLoginModal = document.getElementById('adminLoginModal');
    const checkPassword = document.getElementById('checkPassword');
    const passwordInput = document.getElementById('passwordInput');
    const loginError = document.getElementById('loginError');
    const closeAdminLogin = document.getElementById('closeAdminLogin');
    const menuContainer = document.getElementById('menuContainer');
    const contactSection = document.getElementById('contactSection');
    const imageModal = document.getElementById('imageModal');
    const modalImage = document.getElementById('modalImage');
    const langTR = document.getElementById('langTR');
    const langEN = document.getElementById('langEN');
    const contactTitle = document.getElementById('contactTitle');
    const contactAddress = document.getElementById('contactAddress');
    const tabButtonsContainer = document.getElementById('categoryTabs');
    const viewCountListener = document.getElementById('viewCountListener');

    let language = 'TR'; 
    let products = []; 

    // Kategori √ßevirileri
    const categoryTranslations = {
      'T√ºm√º': 'All', 'Men√ºler': 'Menus', 'Kokore√ß': 'Kokore√ß', 'Tavuk D√∂ner': 'Chicken D√∂ner',
      'K√∂fte': 'Meatballs', 'Ciƒüer': 'Liver', 'Hamburger': 'Hamburger',
      'Yan Lezzetler': 'Side Dishes', 'ƒ∞√ßecekler': 'Drinks', 'ƒ∞leti≈üim': 'Contact'
    };
    let categoriesTR = Object.keys(categoryTranslations);
    let categoriesEN = Object.values(categoryTranslations);

    // --- ZAMAN VE TARƒ∞H YARDIMCI FONKSƒ∞YONLARI ---

    /**
     * Unix zaman damgasƒ±nƒ± alarak g√∂receli bir tarih metni d√∂nd√ºr√ºr (Bug√ºn, D√ºn, 1 hafta √∂nce, gg.aa.yyyy).
     * @param {number} timestamp - Unix zaman damgasƒ± (miliseconds)
     * @returns {string} G√∂receli tarih metni
     */
    function formatRelativeDate(timestamp) {
        if (!timestamp) return "";
        
        const now = new Date();
        const date = new Date(timestamp);
        const diffTime = Math.abs(now.getTime() - date.getTime());
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays === 1) {
            return language === 'TR' ? 'Bug√ºn' : 'Today';
        } else if (diffDays === 2) {
            return language === 'TR' ? 'D√ºn' : 'Yesterday';
        } else if (diffDays <= 7) {
            return language === 'TR' ? `${diffDays - 1} g√ºn √∂nce` : `${diffDays - 1} days ago`;
        } else if (diffDays <= 14) {
            return language === 'TR' ? '1 hafta √∂nce' : '1 week ago';
        } else {
            // dd.mm.yyyy formatƒ±
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}.${month}.${year}`;
        }
    }


    // --- FIREBASE VERƒ∞ ƒ∞≈ûLEME ---

    function transformProducts(dataSnapshot) {
      const productsArray = [];
      dataSnapshot.forEach(childSnapshot => {
        const product = childSnapshot.val();
        product.key = childSnapshot.key;
        // lastUpdated alanƒ± yoksa, ≈üu anki zamanƒ± varsayƒ±lan olarak atar.
        product.lastUpdated = product.lastUpdated || Date.now(); 
        productsArray.push(product);
      });
      return productsArray;
    }

    function setupFirebaseListener() {
        productsRef.on('value', (snapshot) => {
            if (snapshot.exists()) {
                products = transformProducts(snapshot);
            } else {
                products = [];
            }
            updateLanguageContent(); 
        }, (error) => {
            console.error("Firebase veri okuma hatasƒ±:", error);
            alert("Men√ºy√º y√ºklerken bir hata olu≈ütu.");
        });
    }

    // --- Zƒ∞YARET√áƒ∞ SAYACI ƒ∞≈ûLEVƒ∞ ---

    function trackVisitor() {
        // Ziyaret√ßi takibi sadece anasayfada yapƒ±lƒ±r.
        const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
        const counterRef = visitorsRef.child(today);
        
        // Bu veriyi sadece okumak i√ßin bir dinleyici ekliyoruz.
        // Bu dinleyicinin varlƒ±ƒüƒ±, tarayƒ±cƒ±nƒ±n Firebase ile ileti≈üim kurmasƒ±nƒ± saƒülar.
        counterRef.once('value', snapshot => {
            // Burasƒ± sadece okuma i≈ülemi. Arttƒ±rma i≈ülemini Firebase kuralƒ± ile yapƒ±yoruz
        });

        // Firebase Realtime Database'in sunucu tarafƒ± √∂zelliƒüini kullanarak
        // mevcut deƒüeri okumadan direkt 1 arttƒ±rma (atomic increment) i≈ülemini yapƒ±yoruz.
        counterRef.transaction(currentCount => {
            return (currentCount || 0) + 1;
        });

        // Not: Saya√ß sƒ±fƒ±rlama i≈ülevini (her g√ºn) bir Cloud Function veya sunucu g√∂revi
        // gerektirdiƒüi i√ßin ≈üimdilik sadece saya√ß g√ºn bazƒ±nda saymaya devam edecektir.
        // Sƒ±fƒ±rlama i≈ülevi "admin.html" i√ßinde basit√ße y√∂netilecektir.
    }


    // --- UI G√úNCELLEMELERƒ∞ ---

    function renderMenu(category='T√ºm√º'){
      menuContainer.innerHTML='';
      const filtered = category==='T√ºm√º'?products:products.filter(p=>p.category===category);

      filtered.forEach(p=>{
        const card=document.createElement('div');
        card.className='bg-white rounded-xl shadow p-4 flex flex-col hover:shadow-lg transition-shadow duration-200';
        
        const name = language==='TR'?p.name:p.nameEN||p.name;
        const desc = language==='TR'?p.desc:p.descEN||p.desc||'';
        const priceUpdateText = formatRelativeDate(p.lastUpdated);
        const lastUpdateLabel = language === 'TR' ? 'Fiyat g√ºncellendi:' : 'Price updated:';


        card.innerHTML=`
          <img src='${p.image}' alt='${name}' class='w-full h-40 object-cover rounded-lg mb-3 cursor-pointer'>
          <h3 class='font-bold text-xl mb-1'>${name}</h3>
          <p class='text-gray-600 text-sm mb-3 flex-grow'>${desc}</p>
          <div class="flex justify-between items-end">
            <p class='bg-orange-100 text-orange-700 inline-block px-3 py-1 rounded-full font-bold text-lg self-start'>${p.price} ‚Ç∫</p>
            <p class='price-update-info text-right'>${lastUpdateLabel} ${priceUpdateText}</p>
          </div>
        `;
        card.querySelector('img').addEventListener('click',()=>{modalImage.src=p.image;imageModal.classList.remove('hidden');});
        menuContainer.appendChild(card);
      });
    }

    // (Diƒüer UI ve Navigasyon fonksiyonlarƒ± aynƒ± kalƒ±r)
    function createCategoryTabs(){
        tabButtonsContainer.innerHTML = '';
        const categoriesToIterate = categoriesTR;

        categoriesToIterate.forEach((catTR, index) => {
            let btn = document.createElement('button');
            const catName = language === 'TR' ? catTR : categoriesEN[index];

            btn.className='tabBtn px-3 py-1 rounded whitespace-nowrap transition-colors duration-150 hover:bg-orange-200';
            btn.dataset.category=catTR;
            btn.textContent=catName;

            if(catTR==='T√ºm√º') {
                btn.classList.add('active-tab');
            }

            btn.addEventListener('click',()=>{
                document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active-tab'));
                btn.classList.add('active-tab');
                const categoryKey = btn.dataset.category;

                if(categoryKey==='ƒ∞leti≈üim'){
                    menuContainer.innerHTML='';
                    contactSection.classList.remove('hidden');
                } else {
                    contactSection.classList.add('hidden');
                    renderMenu(categoryKey);
                }
            });
            tabButtonsContainer.appendChild(btn);
        });
    }

    function updateLanguageContent() {
        if (language === 'TR') {
            adminLoginBtn.innerHTML = '‚öôÔ∏è Y√∂netici Giri≈üi';
            contactTitle.textContent = 'ƒ∞leti≈üim';
            contactAddress.innerHTML = 'üìç Yamanevler Mah. Alemdaƒü Caddesi No 159 D<br>Olimpiyat Kokore√ß √úmraniye - ƒ∞stanbul';
            langTR.style.fontWeight = 'bold';
            langEN.style.fontWeight = 'normal';
        } else { 
            adminLoginBtn.innerHTML = '‚öôÔ∏è Admin Login';
            contactTitle.textContent = 'Contact';
            contactAddress.innerHTML = 'üìç Yamanevler Mah. Alemdaƒü Caddesi No 159 D<br>Olimpiyat Kokore√ß √úmraniye - Istanbul (Turkey)';
            langTR.style.fontWeight = 'normal';
            langEN.style.fontWeight = 'bold';
        }

        createCategoryTabs();
        const activeTab = document.querySelector('.tabBtn.active-tab');
        const activeCategoryKey = activeTab ? activeTab.dataset.category : 'T√ºm√º';
        
        if (activeCategoryKey === 'ƒ∞leti≈üim') {
            menuContainer.innerHTML = '';
            contactSection.classList.remove('hidden');
        } else {
            contactSection.classList.add('hidden');
            renderMenu(activeCategoryKey);
        }
    }


    // --- EVENT LISTENERS ---

    langTR.addEventListener('click',()=>{ language='TR'; updateLanguageContent(); });
    langEN.addEventListener('click',()=>{ language='EN'; updateLanguageContent(); });
    imageModal.addEventListener('click',()=>imageModal.classList.add('hidden'));
    adminLoginBtn.addEventListener('click',()=>adminLoginModal.classList.remove('hidden'));
    closeAdminLogin.addEventListener('click',()=>adminLoginModal.classList.add('hidden'));

    checkPassword.addEventListener('click',()=>{
      if(passwordInput.value==='admin123'){ 
        // Ba≈üarƒ±lƒ± giri≈ü: Y√∂netici paneli sayfasƒ±na y√∂nlendir
        adminLoginModal.classList.add('hidden');
        window.location.href = 'admin.html'; 
      } else {
        loginError.classList.remove('hidden');
      }
    });

    // --- ƒ∞lk Y√ºkleme ---
    document.addEventListener('DOMContentLoaded', () => {
      setupFirebaseListener(); 
      trackVisitor(); // Ziyaret√ßi sayacƒ±nƒ± √ßalƒ±≈ütƒ±r
    });
  </script>
</body>
</html>
