Elbette, tüm isteklerinizi (turuncu zemin, kalp ritmi ve metin kaldırma, özel görsel ekleme, sürükleme performansı, sayfa kaydırma engeli ve çarpı butonunun oturum bazlı kapatma özelliği) içeren nihai ve tam index.html kodunuz aşağıdadır.
Bu kod, yuvarlak.png dosyanızın index.html ile aynı dizinde olduğunu varsayarak düzenlenmiştir.
Tam ve Nihai index.html Kodu
<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Olimpiyat Kokoreç Menü - Kullanıcı Arayüzü</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  
  <style>
    body { background-color: #fff7f0; }
    .active-tab { background-color: #fb923c; color: white; }
    #categoryTabs::-webkit-scrollbar { display: none; }
    #categoryTabs { -ms-overflow-style: none; scrollbar-width: none; }
    .price-update-info { font-size: 0.7rem; color: #6b7280; margin-top: 5px; } 
    #mainHeader { height: 4rem; }
    
    /* -------------------------------------------------------- */
    /* --- KAMPANYA SLIDER STİLLERİ (Aynı Kaldı) --- */
    
    .slider-container {
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 0; 
        padding-bottom: 56.25%; 
    }

    .slide-wrapper {
        display: flex;
        position: absolute; 
        top: 0;
        left: 0;
        width: 100%; 
        height: 100%;
        overflow-x: auto; 
        scroll-snap-type: x mandatory; 
        scroll-behavior: smooth; 
    }
    
    .slide {
        min-width: 100%;
        width: 100%; 
        flex-shrink: 0;
        position: relative; 
        height: 100%; 
        scroll-snap-align: start; 
    }

    .slide img {
        width: 100%;
        height: 100%; 
        object-fit: cover; 
        background-color: black; 
        border-radius: 0.75rem; 
    }
    
    .slider-dots {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 8px;
        z-index: 10;
    }

    .dot {
        width: 10px;
        height: 10px;
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .dot.active {
        background-color: #fb923c;
    }
    
    .campaign-price-tag {
        position: absolute;
        bottom: 15px; 
        right: 15px;
        background-color: #ef4444; 
        color: white;
        padding: 10px;
        border-radius: 50%;
        min-width: 60px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1rem;
        font-weight: bold;
        text-align: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        z-index: 5;
        white-space: normal;
        line-height: 1.2;
    }
    
    .campaign-price-tag.long-text {
        min-width: 70px;
        height: 70px;
        font-size: 0.85rem;
        padding: 6px;
    }
    
    /* -------------------------------------------------------- */
    /* --- YENİ: SABİT YORUM BUTONU STİLİ --- */
    
    #floatingRatingButton {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 70px; 
        height: 70px; 
        border-radius: 50%;
        background-color: #fb923c; /* Full Turuncu */
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        z-index: 50; 
        cursor: grab; 
        transition: box-shadow 0.2s;
        user-select: none; 
    }
    
    #floatingRatingButton:active {
        cursor: grabbing;
    }
    
    /* Kapatma Butonu */
    #closeFloatingButton {
        position: absolute;
        top: 0px; 
        left: 5px; 
        width: 20px;
        height: 20px;
        background-color: rgba(255, 255, 255, 0.8);
        color: #333;
        border: 1px solid #ddd; 
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 0.8rem;
        font-weight: bold;
        cursor: pointer;
        z-index: 51; 
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        line-height: 1; 
    }
    
    .initial-position {
        right: 20px;
        bottom: 20px;
    }
    
  </style>
</head>
<body class="text-gray-800">
  
  <div id="viewCountListener" style="display:none;"></div> 

  <header id="mainHeader" class="bg-orange-500 text-white p-3 flex justify-between items-center sticky top-0 z-20 shadow-md">
    <h1 class="text-2xl font-bold">Olimpiyat Kokoreç</h1>
    <div class="flex items-center gap-2">
      <button id="langTR" class="bg-white text-orange-600 px-2 py-1 rounded text-sm font-bold">TR</button>
      <button id="langEN" class="bg-white text-orange-600 px-2 py-1 rounded text-sm">EN</button>
      <button id="adminLoginBtn" class="bg-white text-orange-600 px-2 py-1 rounded text-lg font-bold ml-2">⚙️</button>
    </div>
  </header>

  <nav id="categoryTabs" class="flex overflow-x-auto bg-white shadow p-2 space-x-2 text-sm font-semibold sticky top-16 z-10"></nav>

  <main class="p-4">
    
    <div class="bg-white rounded-xl shadow mb-4 p-0"> 
        <section id="campaignSlider"></section>
    </div>
    
    <div id="menuContainer" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <div id="contactSection" class="hidden text-center mt-6 bg-white rounded-xl shadow p-6 max-w-lg mx-auto">
      <h2 id="contactTitle" class="text-2xl font-bold text-orange-600 mb-3">İletişim</h2>
      <p id="contactAddress" class="mb-3">📍 Yamanevler Mah. Alemdağ Caddesi No 159 D<br>Olimpiyat Kokoreç Ümraniye - İstanbul</p>
      <p class="mt-2">📞 <a href="tel:02163357920" id="contactPhone" class="text-orange-600 font-semibold text-lg hover:underline">0216 335 79 20</a></p>
    </div>
  </main>

  <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 transition-opacity">
    <img id="modalImage" class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl transition-transform">
  </div>

  <div id="adminLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-96 relative">
      <button id="closeAdminLogin" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">✖</button>
      <h2 class="text-xl font-bold mb-3 text-orange-600">Yönetici Girişi</h2>
      <input id="passwordInput" type="password" placeholder="Şifreyi giriniz" class="border w-full p-2 rounded mb-3 focus:ring-orange-500 focus:border-orange-500" />
      <button id="checkPassword" class="bg-orange-500 text-white px-4 py-2 rounded w-full hover:bg-orange-600 transition">Giriş Yap</button>
      <p id="loginError" class="text-red-600 text-sm mt-2 hidden">Hatalı şifre!</p>
    </div>
  </div>
  
  <div id="ratingModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-[100]">
    <div class="bg-white rounded-xl shadow-lg p-6 w-11/12 max-w-sm relative text-center">
      <h2 class="text-2xl font-bold mb-4 text-orange-600">Bizi Puanlayın!</h2>
      <p class="mb-5 text-gray-700">Deneyiminizden memnun kaldıysanız, bir dakikanızı ayırıp Google'da bize 5 yıldız verebilir misiniz? 🌟</p>
      
      <a id="goToRatingLink" 
         href="https://search.google.com/local/writereview?placeid=ChIJXXQYlvDIyhQReratRBFh_TY" 
         target="_blank"  
         class="bg-green-500 text-white px-6 py-3 rounded-xl w-full font-bold text-lg 
                flex items-center justify-center space-x-2 hover:bg-green-600 transition">
          <span>Hemen 5 Yıldız Ver</span> 
          <span>⭐</span>
      </a>
      
      <button id="closeRatingModal" 
              class="text-gray-500 mt-4 text-sm hover:text-gray-800 transition block w-full">
          Hayır, teşekkürler
      </button>
    </div>
  </div>
  <button id="floatingRatingButton" class="initial-position" title="Bizi Google'da Puanlayın">
      <div id="closeFloatingButton">x</div> 
      
      <img src="yuvarlak.png" 
           alt="Puanla Butonu Görseli" 
           class="w-full h-full object-contain p-2" 
           style="filter: drop-shadow(0 0 2px rgba(0,0,0,0.5));"
      >
  </button>
  <script>
    // --- Firebase Yapılandırması (Aynı Kaldı) ---
    const firebaseConfig = {
        apiKey: "AIzaSyDcYNF0hMow-y1MuV3GXLG9vY_MK0tJTGs",
        authDomain: "olimpiyatkokorecmenu.firebaseapp.com",
        projectId: "olimpiyatkokorecmenu",
        messagingSenderId: "987017604417",
        appId: "1:987017604417:web:b6c4858712dc66d14745c0",
        measurementId: "G-HB0J7BFZ9N",
        databaseURL: "https://olimpiyatkokorecmenu-default-rtdb.europe-west1.firebasedatabase.app" 
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const productsRef = database.ref('products');
    const visitorsRef = database.ref('visitors'); 
    const campaignsRef = database.ref('campaigns'); 
    const campaignInfoRef = database.ref('campaign_info'); 

    // --- HTML Element Tanımlamaları ---
    const menuContainer = document.getElementById('menuContainer');
    const contactSection = document.getElementById('contactSection');
    const campaignSliderSection = document.getElementById('campaignSlider'); 
    const ratingModal = document.getElementById('ratingModal'); 
    const goToRatingLink = document.getElementById('goToRatingLink'); 
    const closeRatingModal = document.getElementById('closeRatingModal'); 
    const floatingRatingButton = document.getElementById('floatingRatingButton'); 
    const closeFloatingButton = document.getElementById('closeFloatingButton'); 

    let language = 'TR'; 
    let products = []; 
    let campaignUrls = []; 
    let campaignPriceText = ""; 
    let currentSlide = 0;
    let sliderInterval;
    
    // Kategori çevirileri (Aynı Kaldı)
    const categoryTranslations = {
      'Tümü': 'All', 
      'Menüler': 'Menus', 
      'Kokoreç': 'Kokoreç', 
      'Tavuk Kokoreç': 'Chicken Kokoreç', 
      'Tavuk Döner': 'Chicken Döner', 
      'Patso': 'Patso',                  
      'Köfte': 'Meatballs', 
      'Ciğer': 'Liver', 
      'Hamburger': 'Hamburger', 
      'Midye': 'Mussel',
      'Yan Lezzetler': 'Side Dishes', 
      'Tost': 'Toast',                   
      'İçecekler': 'Drinks', 
      'İletişim': 'Contact'
    };
    let categoriesTR = Object.keys(categoryTranslations);
    let categoriesEN = Object.values(categoryTranslations);

    
    // --- SLIDER, FIREBASE, RENDER FONKSİYONLARI (Aynı Kaldı) ---

    function setPositionByIndex() {
        if (campaignUrls.length === 0) return;
        const sliderContainer = document.querySelector('#campaignSlider');
        const wrapper = document.querySelector('#campaignSlider .slide-wrapper');
        if (!wrapper || !sliderContainer) return;
        
        const slideWidth = sliderContainer.clientWidth; 
        wrapper.scrollLeft = currentSlide * slideWidth;
        
        const dots = document.querySelectorAll('#campaignSlider .dot');
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === currentSlide);
        });
    }
    
    function startSliderInterval() {
        if (sliderInterval) clearInterval(sliderInterval);
        
        if (campaignUrls.length > 1) {
            sliderInterval = setInterval(() => {
                const nextSlide = (currentSlide + 1) % campaignUrls.length;
                goToSlide(nextSlide);
            }, 5000); 
        }
    }

    function goToSlide(index) {
        if (campaignUrls.length === 0) return;
        currentSlide = index;
        setPositionByIndex();
    }
    
    function handleScroll() {
        const wrapper = document.querySelector('#campaignSlider .slide-wrapper');
        const sliderContainer = document.querySelector('#campaignSlider');
        if (!wrapper || !sliderContainer) return;
        
        const scrollLeft = wrapper.scrollLeft;
        const slideWidth = sliderContainer.clientWidth;
        const newSlideIndex = Math.round(scrollLeft / slideWidth);
        
        if (newSlideIndex !== currentSlide) {
            currentSlide = newSlideIndex;
            const dots = document.querySelectorAll('#campaignSlider .dot');
            dots.forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });
            startSliderInterval(); 
        }
    }

    function renderCampaignSlider() {
        if (campaignUrls.length === 0) {
            campaignSliderSection.innerHTML = '';
            campaignSliderSection.parentElement.classList.add('hidden');
            return;
        }

        campaignSliderSection.parentElement.classList.remove('hidden');
        
        const priceTagHtml = campaignPriceText ? `
            <div class="campaign-price-tag ${campaignPriceText.length > 8 ? 'long-text' : ''}">
                ${campaignPriceText}
            </div>
        ` : '';

        const slidesHtml = campaignUrls.map((c, index) => `
            <div class="slide">
                <img src="${c.url}" alt="Kampanya Görseli" class="rounded-xl">
                ${index === 0 ? priceTagHtml : ''} 
            </div>
        `).join('');

        const dotsHtml = campaignUrls.map((_, i) => `
            <div class="dot ${i === currentSlide ? 'active' : ''}" data-index="${i}"></div>
        `).join('');
        
        campaignSliderSection.innerHTML = `
            <div class="slider-container">
                <div class="slide-wrapper" style="width: 100%;"> 
                    ${slidesHtml}
                </div>
                <div class="slider-dots">
                    ${dotsHtml}
                </div>
            </div>
        `;

        const sliderWrapper = document.querySelector('#campaignSlider .slide-wrapper');
        if (sliderWrapper) {
             sliderWrapper.addEventListener('scroll', handleScroll, { passive: true });
        }
        
        document.querySelectorAll('#campaignSlider .dot').forEach(dot => {
            dot.addEventListener('click', (e) => {
                goToSlide(parseInt(e.target.dataset.index));
                startSliderInterval(); 
            });
        });
        
        goToSlide(currentSlide);
        startSliderInterval();
    }


    function formatRelativeDate(timestamp) {
        if (!timestamp) return "";
        const now = Date.now();
        const diffTime = now - timestamp; 
        const diffMinutes = Math.floor(diffTime / 60000);
        const diffHours = Math.floor(diffMinutes / 60);
        const diffDays = Math.floor(diffHours / 24);

        const TR = {
            min: (m) => `${m} dakika önce`,
            hour: (h) => `${h} saat önce`,
            day: (d) => `${d} gün önce`,
            today: 'Bugün',
            yesterday: 'Dün',
            week: '1 hafta önce',
            date: (d, m, y) => `${d}.${m}.${y}`
        };

        const EN = {
            min: (m) => `${m} minutes ago`,
            hour: (h) => `${h} hours ago`,
            day: (d) => `${d} days ago`,
            today: 'Today',
            yesterday: 'Yesterday',
            week: '1 week ago',
            date: (d, m, y) => `${d}/${m}/${y}`
        };

        const t = language === 'TR' ? TR : EN;

        if (diffMinutes < 60) {
            if (diffMinutes < 5) return t.today; 
            return t.min(diffMinutes);
        } else if (diffHours < 24) {
            return t.hour(diffHours);
        } else if (diffDays === 1) {
             return t.yesterday; 
        } else if (diffDays <= 7) {
            return t.day(diffDays); 
        } else if (diffDays <= 14) {
            return t.week;
        } else {
            const date = new Date(timestamp);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return t.date(day, month, year);
        }
    }


    function transformProducts(dataSnapshot) {
      const productsArray = [];
      dataSnapshot.forEach(childSnapshot => {
        const product = childSnapshot.val();
        product.key = childSnapshot.key;
        product.lastUpdated = product.lastUpdated || Date.now(); 
        productsArray.push(product);
      });
      
      productsArray.sort((a, b) => (a.order === undefined ? 9999 : a.order) - (b.order === undefined ? 9999 : b.order));
      
      return productsArray;
    }

    function setupFirebaseListener() {
        productsRef.on('value', (snapshot) => {
            products = snapshot.exists() ? transformProducts(snapshot) : [];
            updateLanguageContent(); 
        }, (error) => {
            console.error("Firebase ürün veri okuma hatası:", error);
            alert("Menüyü yüklerken bir hata oluştu.");
        });
        
        campaignsRef.on('value', (snapshot) => {
             campaignUrls = [];
             snapshot.forEach(childSnapshot => {
                 const campaign = childSnapshot.val();
                 campaign.key = childSnapshot.key;
                 campaignUrls.push(campaign);
             });
             campaignUrls.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
             
             currentSlide = 0; 
             renderCampaignSlider();
        });
        
        campaignInfoRef.child('price_text').on('value', (snapshot) => {
             campaignPriceText = snapshot.val() || "";
             renderCampaignSlider();
        });
    }

    function trackVisitor() {
        const today = new Date().toISOString().slice(0, 10); 
        const counterRef = visitorsRef.child(today);
        
        counterRef.once('value', snapshot => {}); 
        
        counterRef.transaction(currentCount => {
            return (currentCount || 0) + 1;
        });
    }


    function renderMenu(category='Tümü'){
      menuContainer.innerHTML='';
      const filtered = category==='Tümü'?products:products.filter(p=>p.category===category);

      filtered.forEach(p=>{
        const card=document.createElement('div');
        card.className='bg-white rounded-xl shadow p-4 flex flex-col hover:shadow-lg transition-shadow duration-200';
        const name = language==='TR'?p.name:p.nameEN||p.name;
        const desc = language==='TR'?p.desc:p.descEN||p.desc||'';
        const priceUpdateText = formatRelativeDate(p.lastUpdated); 
        const lastUpdateLabel = language === 'TR' ? 'Fiyat güncellendi:' : 'Price updated:';
        
        const imageUrl = p.image && p.image.trim() !== '' 
                         ? p.image 
                         : 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="10" fill="%239ca3af">Görsel Yüklenmedi</text></svg>';
        
        const imageClass = p.image && p.image.trim() !== '' ? 'cursor-pointer' : 'opacity-70';


        card.innerHTML=`
          <img src='${imageUrl}' alt='${name}' class='w-full h-40 object-cover rounded-lg mb-3 ${imageClass}'>
          <h3 class='font-bold text-xl mb-1'>${name}</h3>
          <p class='text-gray-600 text-sm mb-3 flex-grow'>${desc}</p>
          <div class="flex justify-between items-end">
            <p class='bg-orange-100 text-orange-700 inline-block px-3 py-1 rounded-full font-bold text-lg self-start'>${p.price} ₺</p>
            <p class='price-update-info text-right'>${lastUpdateLabel} ${priceUpdateText}</p>
          </div>
        `;
        
        if (p.image && p.image.trim() !== '') {
            card.querySelector('img').addEventListener('click',()=>{modalImage.src=p.image;imageModal.classList.remove('hidden');});
        }
        
        menuContainer.appendChild(card);
      });
    }

    function createCategoryTabs(){
        const tabButtonsContainer = document.getElementById('categoryTabs');
        tabButtonsContainer.innerHTML = '';
        const categoriesToIterate = categoriesTR;

        categoriesToIterate.forEach((catTR, index) => {
            let btn = document.createElement('button');
            const catName = language === 'TR' ? catTR : categoriesEN[index];

            btn.className='tabBtn px-3 py-1 rounded whitespace-nowrap transition-colors duration-150 hover:bg-orange-200';
            btn.dataset.category=catTR;
            btn.textContent=catName;

            if(catTR==='Tümü') {
                btn.classList.add('active-tab');
            }

            btn.addEventListener('click',()=>{
                document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active-tab'));
                btn.classList.add('active-tab');
                const categoryKey = btn.dataset.category;

                if(categoryKey==='İletişim'){
                    menuContainer.innerHTML='';
                    campaignSliderSection.parentElement.classList.add('hidden'); 
                    contactSection.classList.remove('hidden');
                } else {
                    contactSection.classList.add('hidden');
                    renderCampaignSlider(); 
                    renderMenu(categoryKey);
                }
            });
            tabButtonsContainer.appendChild(btn);
        });
    }

    function updateLanguageContent() {
        const langTR = document.getElementById('langTR');
        const langEN = document.getElementById('langEN');
        const contactTitle = document.getElementById('contactTitle');
        const contactAddress = document.getElementById('contactAddress');
        
        if (language === 'TR') {
            langTR.style.fontWeight = 'bold';
            langEN.style.fontWeight = 'normal';
            contactTitle.textContent = 'İletişim';
            contactAddress.innerHTML = '📍 Yamanevler Mah. Alemdağ Caddesi No 159 D<br>Olimpiyat Kokoreç Ümraniye - İstanbul';
        } else { 
            langTR.style.fontWeight = 'normal';
            langEN.style.fontWeight = 'bold';
            contactTitle.textContent = 'Contact';
            contactAddress.innerHTML = '📍 Yamanevler Mah. Alemdağ Caddesi No 159 D<br>Olimpiyat Kokoreç Ümraniye - Istanbul (Turkey)';
        }

        createCategoryTabs();
        const activeTab = document.querySelector('.tabBtn.active-tab');
        const activeCategoryKey = activeTab ? activeTab.dataset.category : 'Tümü';
        
        if (activeCategoryKey === 'İletişim') {
            menuContainer.innerHTML = '';
            campaignSliderSection.parentElement.classList.add('hidden');
            contactSection.classList.remove('hidden');
        } else {
            contactSection.classList.add('hidden');
            renderCampaignSlider();
            renderMenu(activeCategoryKey);
        }
    }
    
    // --- YORUM MODALI VE SABİT BUTON MANTIĞI ---

    const RATING_INTERVALS = [6000, 12000, 18000];
    
    function isModalPermanentlyDisabled() {
        return localStorage.getItem('olimpiyat_rated') === 'true';
    }
    
    function isFloatingButtonClosedSession() {
        // Oturum bazlı kapatma için Session Storage kullanılır (Sayfa yenilenince geri gelir)
        return sessionStorage.getItem('olimpiyat_floating_closed_session') === 'true';
    }

    function showRatingModal() {
        if (isModalPermanentlyDisabled() || sessionStorage.getItem('olimpiyat_rated_session_closed') === 'true') {
            return;
        }
        ratingModal.classList.remove('hidden');
    }
    
    function setupIntervals() {
        if (isModalPermanentlyDisabled()) {
            return;
        }
        
        RATING_INTERVALS.forEach(delay => {
            setTimeout(() => {
                if (ratingModal.classList.contains('hidden') && !isModalPermanentlyDisabled()) {
                    showRatingModal();
                }
            }, delay);
        });
    }

    // Yorum linkine tıklandığında: Kalıcı olarak yorum yapma ekranına gitti kaydını tut
    goToRatingLink.addEventListener('click', () => {
        localStorage.setItem('olimpiyat_rated', 'true'); 
        ratingModal.classList.add('hidden');
        floatingRatingButton.classList.add('hidden');
        sessionStorage.setItem('olimpiyat_floating_closed_session', 'true');
    });

    // Kapatma butonuna tıklandığında: Sadece bu oturum için kapat kaydını tut
    closeRatingModal.addEventListener('click', () => {
        sessionStorage.setItem('olimpiyat_rated_session_closed', 'true');
        ratingModal.classList.add('hidden');
    });
    
    // Sabit butona TIKLAMA işlevi (modalı açar) 
    floatingRatingButton.addEventListener('click', (event) => {
        // Eğer tıklama kapatma butonundan gelmediyse VE SÜRÜKLEME YAPILMAMIŞSA
        if (event.target !== closeFloatingButton && !closeFloatingButton.contains(event.target) && !floatingRatingButton.isMoved) {
            ratingModal.classList.remove('hidden');
        }
        // Tıklama işlevi bitti, isMoved'ı sıfırla
        floatingRatingButton.isMoved = false; 
    });
    
    // Sabit butondaki kapatma (x) butonuna tıklandığında
    closeFloatingButton.addEventListener('click', (event) => {
        event.stopPropagation(); // Butonun ana tıklama olayını engelle
        floatingRatingButton.classList.add('hidden');
        // İstenen özellik: Sayfa yenilendiğinde geri gelmesi için sessionStorage kullan
        sessionStorage.setItem('olimpiyat_floating_closed_session', 'true');
    });

    // --- SÜRÜKLEME (DRAG) İŞLEVİ - KASMA VE KAYDIRMA ENGELİ DÜZELTİLDİ ---
    
    let isDragging = false;
    let offsetX, offsetY;
    let initialX, initialY;
    
    floatingRatingButton.isMoved = false;

    function onMouseDown(e) {
        if (e.target.id === 'closeFloatingButton' || e.target.parentElement.id === 'closeFloatingButton') {
            return;
        }
        
        isDragging = true;
        floatingRatingButton.isMoved = false;
        floatingRatingButton.style.transition = 'none'; 
        
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        
        const rect = floatingRatingButton.getBoundingClientRect();
        
        offsetX = clientX - rect.left;
        offsetY = clientY - rect.top;
        initialX = clientX;
        initialY = clientY;
        
        floatingRatingButton.style.cursor = 'grabbing';
        
        // Sürükleme sırasında sayfa kaydırmayı engelle
        if (e.type === 'touchstart') {
            document.body.style.overflow = 'hidden';
            e.preventDefault(); 
        }

        document.addEventListener('mousemove', onMouseMove, { passive: false });
        document.addEventListener('mouseup', onMouseUp);
        document.addEventListener('touchmove', onMouseMove, { passive: false });
        document.addEventListener('touchend', onMouseUp);
    }
    
    function onMouseMove(e) {
        if (!isDragging) return;
        
        // Mobil cihazlarda varsayılan kaydırmayı engelle
        if (e.cancelable) {
            e.preventDefault();
        }
        
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        
        // Tıklama mı sürükleme mi kontrolü (Mesafe > 5px ise sürükleme say)
        const distance = Math.sqrt(Math.pow(clientX - initialX, 2) + Math.pow(clientY - initialY, 2));
        if (distance > 5) {
            floatingRatingButton.isMoved = true;
        }

        let newX = clientX - offsetX;
        let newY = clientY - offsetY;
        
        const buttonWidth = floatingRatingButton.offsetWidth;
        const buttonHeight = floatingRatingButton.offsetHeight;
        const maxX = window.innerWidth - buttonWidth;
        const maxY = window.innerHeight - buttonHeight;
        
        newX = Math.max(0, Math.min(newX, maxX));
        newY = Math.max(0, Math.min(newY, maxY));

        // Top/Left kullanarak konum güncelleme (Kasmayı engeller)
        floatingRatingButton.style.left = `${newX}px`;
        floatingRatingButton.style.top = `${newY}px`;
        floatingRatingButton.style.right = 'auto'; 
        floatingRatingButton.style.bottom = 'auto'; 
    }
    
    function onMouseUp(e) {
        if (!isDragging) return;
        
        isDragging = false;
        floatingRatingButton.style.cursor = 'grab';
        
        // Sürükleme sırasında engellenen kaydırmayı geri aç
        document.body.style.overflow = 'auto';
        
        document.removeEventListener('mousemove', onMouseMove, { passive: false });
        document.removeEventListener('mouseup', onMouseUp);
        document.removeEventListener('touchmove', onMouseMove, { passive: false });
        document.removeEventListener('touchend', onMouseUp);
        
        if (floatingRatingButton.isMoved) {
            const rect = floatingRatingButton.getBoundingClientRect();
            // Yeni konumu (pencerenin sağ alt köşesine göre) kaydet
            const savedRight = window.innerWidth - (rect.left + rect.width);
            const savedBottom = window.innerHeight - (rect.top + rect.height);
            
            localStorage.setItem('olimpiyat_floating_pos', JSON.stringify({ right: savedRight, bottom: savedBottom }));
        }
        
        floatingRatingButton.style.transition = 'box-shadow 0.2s'; 
    }

    floatingRatingButton.addEventListener('mousedown', onMouseDown);
    floatingRatingButton.addEventListener('touchstart', onMouseDown);

    // Konumu Yükle
    function loadFloatingButtonPosition() {
        const savedPos = localStorage.getItem('olimpiyat_floating_pos');
        if (savedPos) {
            const { right, bottom } = JSON.parse(savedPos);
            // Sürüklenen konumu koru
            floatingRatingButton.style.right = `${right}px`;
            floatingRatingButton.style.bottom = `${bottom}px`;
            floatingRatingButton.classList.remove('initial-position'); 
        } else {
             floatingRatingButton.style.right = '20px';
             floatingRatingButton.style.bottom = '20px';
        }
        
        // Butonun görünürlük kontrolü
        if (isFloatingButtonClosedSession() || isModalPermanentlyDisabled()) {
            floatingRatingButton.classList.add('hidden');
        } else {
            floatingRatingButton.classList.remove('hidden');
        }
    }
    
    // --- EVENT LISTENERS (Aynı Kaldı) ---

    document.getElementById('langTR').addEventListener('click',()=>{ language='TR'; updateLanguageContent(); });
    document.getElementById('langEN').addEventListener('click',()=>{ language='EN'; updateLanguageContent(); });
    document.getElementById('imageModal').addEventListener('click',()=>document.getElementById('imageModal').classList.add('hidden'));
    document.getElementById('adminLoginBtn').addEventListener('click',()=>document.getElementById('adminLoginModal').classList.remove('hidden'));
    document.getElementById('closeAdminLogin').addEventListener('click',()=>document.getElementById('adminLoginModal').classList.add('hidden'));

    document.getElementById('checkPassword').addEventListener('click',()=>{
        const passwordInput = document.getElementById('passwordInput');
        const loginError = document.getElementById('loginError');
        const adminLoginModal = document.getElementById('adminLoginModal');
        
        if(passwordInput.value==='admin123'){ 
            adminLoginModal.classList.add('hidden');
            window.location.href = 'admin.html'; 
        } else {
            loginError.classList.remove('hidden');
        }
    });

    // --- İlk Yükleme ---
    document.addEventListener('DOMContentLoaded', () => {
      setupFirebaseListener(); 
      trackVisitor(); 
      loadFloatingButtonPosition(); 
      
      window.addEventListener('resize', setPositionByIndex); 
      
      setupIntervals();
    });
  </script>
</body>
</html>

