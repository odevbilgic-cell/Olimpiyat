<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="olimpiyat kokoreÃ§ paket servis menÃ¼sÃ¼" />
  <meta name="keywords" content="olimpiyat, kokoreÃ§, paket servis, dÃ¶ner, Ã¼mraniye, yemek" />
  <title>Olimpiyat KokoreÃ§ | PAKET SERVÄ°S MENÃœSÃœ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script> 
  
  <style>
    /* DÄ°KKAT: Ana renk KÄ±rmÄ±zÄ±/Red (Paket Servis TemasÄ±) */
    body { background-color: #fff7f0; }
    .active-tab { background-color: #ef4444; color: white; z-index: 8;} /* KÄ±rmÄ±zÄ± */
    #categoryTabs::-webkit-scrollbar { display: none;}
    #categoryTabs { -ms-overflow-style: none; scrollbar-width: none; z-index: 11; }
    .price-update-info { font-size: 0.7rem; color: #6b7280; margin-top: 5px;} 
    #mainHeader { height: 4rem;  }
    
    /* --- KAMPANYA SLIDER STÄ°LLERÄ° --- */
    .slider-container { position: relative; overflow: hidden; width: 100%; height: 0; padding-bottom: 56.25%; }
    .slide-wrapper { display: flex; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-x: auto; scroll-snap-type: x mandatory; scroll-behavior: smooth; }
    .slide { min-width: 100%; width: 100%; flex-shrink: 0; position: relative; height: 100%; scroll-snap-align: start; }
    .slide img { width: 100%; height: 100%; object-fit: cover; background-color: black; border-radius: 0.75rem; }
    .slider-dots { position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 10; }
    .dot { width: 10px; height: 10px; background-color: rgba(255, 255, 255, 0.5); border-radius: 50%; cursor: pointer; transition: background-color 0.3s; }
    .dot.active { background-color: #ef4444; } /* KÄ±rmÄ±zÄ± */
    
    /* --- GÃ–RSEL ÃœZERÄ°NDEKÄ° FÄ°YAT YAZISI --- */
    .campaign-price-overlay {
        position: absolute;
        bottom: 7%;  /* GÃ¶rselin sol altÄ±ndaki turuncu blob hizasÄ± */
        left: 6%;    
        width: 35%;  
        height: 15%; 
        display: flex;
        justify-content: center; 
        align-items: center;     
        z-index: 6;
        /* -webkit-text-stroke: 3px black; */
        
        /* Metin Stili */
        color: white;
        font-family: 'Arial Black', 'Impact', sans-serif; 
        font-size: clamp(3rem, 8vw, 5rem); 
        font-weight: 900;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.4); 
        transform: rotate(-deg); 
        text-align: center;
        line-height: 1;}

    /* --- ORTAK SABÄ°T BUTON STÄ°LÄ° --- */
    .floating-btn { 
        position: fixed; 
        right: 20px; 
        width: 60px; 
        height: 60px; 
        border-radius: 50%; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4); 
        z-index: 50; 
        cursor: pointer; 
        transition: transform 0.2s, box-shadow 0.2s; 
        border: 2px solid white;
        color: white;
        font-weight: bold;
        font-size: 12px;
        text-align: center;
        
        /* Genel ayarlar */
        background-position: center;
        background-repeat: no-repeat;
    }
    .floating-btn:hover { transform: scale(1.1); box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5); }

    /* --- BUTONLARA Ã–ZEL BOYUT VE KONUM AYARLARI --- */
    /* Not: background-size deÄŸerlerini logolarÄ±n durumuna gÃ¶re deÄŸiÅŸtirebilirsin */
    
    /* 1. En Altta: Yorum Yap */
    #floatingRatingButton { 
        bottom: 20px; 
        width: 72px; height: 72px; 
        background-image: url(logo/google.png); 
        background-size: 100%; /* Resmi tam doldur */
        border: none;
        background-color: white;
        
        
    }

    /* 2. Telefon */
    #floatingPhoneButton { 
        bottom: 105px; 
        width: 72px; height: 72px; 
        background-color: #ef4444; 
    }

    /* 3. Yemeksepeti */
    #btnYemeksepeti {
        bottom: 400px;
        background-color: #ffffff; 
        background-image: url(logo/yemeksepeti.png);
        background-size: 100%; /* Logoyu %75 boyutunda yap */
    }

    /* 4. Getir Yemek */
    #btnGetir {
        bottom: 330px;
        background-color: #ffffff; 
        background-image: url(logo/getir.png);
        background-size: 100%; /* Logoyu %70 boyutunda yap */
    }

    /* 5. Migros Yemek */
    #btnMigros {
        bottom: 260px;
        background-color: #ffffff; 
        background-image: url(logo/migros.jpg);
        background-size: 100%; /* Logoyu %85 boyutunda yap */
    }

    /* 6. Trendyol Yemek (En Ãœstte) */
    #btnTrendyol {
        bottom: 190px;
        background-color: #ffffff; 
        background-image: url(logo/trendyols.png);
        background-size: 70%; /* Logoyu %80 boyutunda yap */
    }

    #googleGSvg { display: none; }

    .ticker-container {
        width: 100%;
        overflow: hidden;
        background-color: #1f2937; /* Koyu Gri Zemin */
        position: sticky;
        top: 6.5rem; /* TablarÄ±n altÄ±nda kalacak yÃ¼kseklik */
        z-index: 11;
        border-bottom: 1px solid #374151;
    }

    .ticker-track {
        display: flex;
        width: max-content; /* Ä°Ã§erik kadar geniÅŸle */
        /* Animasyon: Soldan SaÄŸa DoÄŸru (Left to Right) */
        animation: scroll-left-to-right 20s linear infinite; 
    }

    .ticker-item {
        color: #ffffff;
        font-size: 0.85rem;
        font-weight: bold;
        padding: 6px 9px; /* YazÄ±lar arasÄ± boÅŸluk */
        white-space: nowrap;
        display: flex;
        align-items: center;
        
    }

    /* Animasyonun MatematiÄŸi: */
    /* Åerit %50 geriden baÅŸlar, %0'a gelince baÅŸa sarar. */
    /* Ä°ki kopya metin olduÄŸu iÃ§in geÃ§iÅŸ hissedilmez. */
    @keyframes scroll-left-to-right {
        0% { transform: translateX(-50%); }
        100% { transform: translateX(0); }
    }

    .uyari{
        font-weight: bolder;
    }
  </style>
</head>
<body class="text-gray-800">
  
  <div id="viewCountListener" style="display:none;"></div> 

  <header id="mainHeader" class="bg-red-600 text-white p-3 flex justify-between items-center sticky top-0 z-20 shadow-md">
    <h1 class="text-2xl font-bold">Olimpiyat KokoreÃ§ <span class="text-sm block font-normal text-red-100">PAKET SERVÄ°S MENÃœSÃœ</span></h1>
    <div class="flex items-center gap-2">
      <button id="langTR" class="bg-white text-red-600 px-2 py-1 rounded text-sm font-bold">TR</button>
      <button id="langEN" class="bg-white text-red-600 px-2 py-1 rounded text-sm">EN</button>
      </div>
  </header>

  <nav id="categoryTabs" class="flex overflow-x-auto bg-white shadow p-2 space-x-2 text-sm font-semibold sticky top-16 z-10"></nav>

  <div class="ticker-container shadow-md">
      <div class="ticker-track">
          <div class="ticker-item">
              ~YEMEK KARTLARI GEÃ‡ERLÄ°DÄ°R~
          </div>
          <div class="ticker-item">
                | Pluxe Sodexo | Ederned | Ticket Restaurant | Multinet | Metropol | Setcard |              
          </div>
           <div class="ticker-item">
              ~YEMEK KARTLARI GEÃ‡ERLÄ°DÄ°R~
          </div>
          <div class="ticker-item">
              | Pluxe Sodexo | Ederned | Ticket Restaurant | Multinet | Metropol | Setcard |
          </div>
      </div>
  </div>

  <main class="p-4">
    <div class="bg-white rounded-xl shadow mb-4 p-0"> 
        <section id="campaignSlider"></section>
    </div>
    <div id="menuContainer" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    <div id="contactSection" class="hidden text-center mt-6 bg-white rounded-xl shadow p-6 max-w-lg mx-auto">
      <h2 id="contactTitle" class="text-2xl font-bold text-red-600 mb-3">Ä°letiÅŸim</h2>
      <p id="contactAddress" class="mb-3">ğŸ“ Yamanevler Mah. AlemdaÄŸ Caddesi No 159 D<br>Olimpiyat KokoreÃ§ Ãœmraniye - Ä°stanbul</p>
      <p class="mt-2">ğŸ“ <a href="tel:02163357920" id="contactPhone" class="text-red-600 font-semibold text-lg hover:underline">0216 335 79 20</a></p>
    </div>
  </main>

  <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 transition-opacity">
    <img id="modalImage" class="max-h-[90vh] max-w-[90vw] rounded-xl shadow-2xl transition-transform">
  </div>

  <div id="adminLoginModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
    <div class="bg-white rounded-xl shadow-lg p-6 w-96 relative">
      <button id="closeAdminLogin" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">âœ–</button>
      <h2 class="text-xl font-bold mb-3 text-red-600">YÃ¶netici GiriÅŸi (Paket)</h2>
      <input id="passwordInput" type="password" placeholder="Åifreyi giriniz" class="border w-full p-2 rounded mb-3 focus:ring-red-500 focus:border-red-500" />
      <button id="checkPassword" class="bg-red-500 text-white px-4 py-2 rounded w-full hover:bg-red-600 transition">GiriÅŸ Yap</button>
      <p id="loginError" class="text-red-600 text-sm mt-2 hidden">HatalÄ± ÅŸifre!</p>
    </div>
  </div>
  
  <div id="ratingModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-[100]">
    <div class="bg-white rounded-xl shadow-lg p-6 w-11/12 max-w-sm relative text-center">
      <h2 class="text-2xl font-bold mb-4 text-red-600">Bizi PuanlayÄ±n!</h2>
      <p class="mb-5 text-gray-700">Deneyiminizden memnun kaldÄ±ysanÄ±z, bir dakikanÄ±zÄ± ayÄ±rÄ±p Google'da bize 5 yÄ±ldÄ±z verebilir misiniz? ğŸŒŸ</p>
      <a id="goToRatingLink" href="https://search.google.com/local/writereview?placeid=ChIJXXQYlvDIyhQReratRBFh_TY" target="_blank" class="bg-green-500 text-white px-6 py-3 rounded-xl w-full font-bold text-lg flex items-center justify-center space-x-2 hover:bg-green-600 transition">
          <span>Hemen 5 YÄ±ldÄ±z Ver</span> <span>â­</span>
      </a>
      <button id="closeRatingModal" class="text-gray-500 mt-4 text-sm hover:text-gray-800 transition block w-full">HayÄ±r, teÅŸekkÃ¼rler</button>
    </div>
  </div>

 <div id="commissionModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-[110]">
    <div class="bg-white rounded-xl shadow-2xl p-6 w-11/12 max-w-sm relative text-center border-t-8 border-red-500">
      <h2 class="text-2xl font-bold mb-4 text-red-600">âš ï¸ UYARI!</h2>
      <p class="mb-6 text-gray-800 font-medium leading-relaxed">
        Yemek sipariÅŸ platformlarÄ±nda verilecek sipariÅŸlerde komisyon nedeniyle farklÄ± fiyatlandÄ±rma olabilir.<br>
        <span class="uyari">Mevcut fiyatlar iÃ§in telefon ile sipariÅŸ verebilirsiniz.</span>
      </p>
      
      <button id="confirmRedirect" class="bg-red-600 text-white px-6 py-3 rounded-xl w-full font-bold text-lg hover:bg-red-700 transition shadow-lg">
          Tamam, Devam Et
      </button>

      <a href="tel:02163357920" class="bg-green-500 text-white px-6 py-3 rounded-xl w-full font-bold text-lg hover:bg-green-600 transition shadow-lg mt-3 flex items-center justify-center gap-2 decoration-0">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
          </svg>
          Telefon ile SipariÅŸ Ver
      </a>
      <button id="cancelRedirect" class="text-gray-500 mt-4 text-sm hover:text-gray-800 transition block w-full">Ä°ptal</button>
    </div>
  </div>
  
  <div id="btnTrendyol" class="floating-btn" title="Trendyol Yemek"></div>
  <div id="btnMigros" class="floating-btn" title="Migros Yemek"></div>
  <div id="btnGetir" class="floating-btn" title="Getir Yemek"></div>
  <div id="btnYemeksepeti" class="floating-btn" title="Yemeksepeti"></div>

  <a id="floatingPhoneButton" href="tel:02163357920" class="floating-btn" title="Hemen Ara SipariÅŸ Ver">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-8 h-8">
      <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
    </svg>
  </a>

  <button id="floatingRatingButton" class="floating-btn" title="Bizi Google'da PuanlayÄ±n"></button>
  
  <script>
    // --- Firebase YapÄ±landÄ±rmasÄ± ---
    const firebaseConfig = {
        apiKey: "AIzaSyDcYNF0hMow-y1MuV3GXLG9vY_MK0tJTGs",
        authDomain: "olimpiyatkokorecmenu.firebaseapp.com",
        projectId: "olimpiyatkokorecmenu",
        messagingSenderId: "987017604417",
        appId: "1:987017604417:web:b6c4858712dc66d14745c0",
        measurementId: "G-HB0J7BFZ9N",
        databaseURL: "https://olimpiyatkokorecmenu-default-rtdb.europe-west1.firebasedatabase.app" 
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    const productsRef = database.ref('delivery_products'); 
    const visitorsRef = database.ref('delivery_visitors'); 
    const campaignsRef = database.ref('delivery_campaigns'); 

    const menuContainer = document.getElementById('menuContainer');
    const contactSection = document.getElementById('contactSection');
    const campaignSliderSection = document.getElementById('campaignSlider'); 
    const ratingModal = document.getElementById('ratingModal'); 
    const goToRatingLink = document.getElementById('goToRatingLink'); 
    const closeRatingModal = document.getElementById('closeRatingModal'); 
    const floatingRatingButton = document.getElementById('floatingRatingButton'); 

    const commissionModal = document.getElementById('commissionModal');
    const confirmRedirectBtn = document.getElementById('confirmRedirect');
    const cancelRedirectBtn = document.getElementById('cancelRedirect');
    
    let language = 'TR'; 
    let products = []; 
    let campaignUrls = []; 
    let currentSlide = 0;
    let sliderInterval;
    let targetPlatformUrl = ""; 

    const categoryTranslations = {
      'TÃ¼mÃ¼': 'All', 'MenÃ¼ler': 'Menus', 'KokoreÃ§': 'KokoreÃ§', 'Tavuk KokoreÃ§': 'Chicken KokoreÃ§', 
      'Tavuk DÃ¶ner': 'Chicken DÃ¶ner', 'Patso': 'Patso', 'KÃ¶fte': 'Meatballs', 'CiÄŸer': 'Liver', 
      'Hamburger': 'Hamburger', 'Midye': 'Mussel', 'Yan Lezzetler': 'Side Dishes', 'Tost': 'Toast', 'Ä°Ã§ecekler': 'Drinks', 'Ä°letiÅŸim': 'Contact'
    };
    let categoriesTR = Object.keys(categoryTranslations);
    let categoriesEN = Object.values(categoryTranslations);

    function openPlatformModal(url) {
        targetPlatformUrl = url;
        commissionModal.classList.remove('hidden');
    }

    confirmRedirectBtn.addEventListener('click', () => {
      if(targetPlatformUrl) {
          // Link Trendyol ise Ã¶zel bir iÅŸlem yapÄ±yoruz
          if(targetPlatformUrl.includes("https://www.trendyol.com/s/trendyol-yemek")) {
              
              // EÄŸer mobildelerse (Android/iPhone)
              if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){
                  // Bu komut tarayÄ±cÄ±ya "Bu linki Trendyol UygulamasÄ± ile aÃ§" emrini verir.
                  window.location.href = targetPlatformUrl;
              } 
              // Bilgisayardalarsa
              else {
                  alert("Trendyol Yemek sipariÅŸleri sadece telefon uygulamasÄ±ndan verilebilir.");
                  // Ä°stersen burada yine de genel sayfayÄ± aÃ§tÄ±rabilirsin:
                  window.open("https://www.trendyol.com/s/trendyol-yemek", '_blank');
              }
          } 
          // DiÄŸer Yemek KartlarÄ± (Yemeksepeti, Getir, Migros)
          else {
              window.open(targetPlatformUrl, '_blank'); 
          }
      }
      commissionModal.classList.add('hidden');

      
    });
    
        cancelRedirectBtn.addEventListener('click', () => {
        commissionModal.classList.add('hidden'); // ModalÄ± gizle
        targetPlatformUrl = ""; // Hedef linki temizle (Garanti olsun diye)
  });

    // --- BUTON TIKLAMALARI ---
    
    // Ä°ÅTE SENÄ°N Ä°STEDÄ°ÄÄ°N LÄ°NKÄ°N ID EKLENMÄ°Å HALÄ°:
    // "Page=Meal" -> Yemek BÃ¶lÃ¼mÃ¼
    // "ContentId=212061" -> Senin RestoranÄ±n
    document.getElementById('btnTrendyol').addEventListener('click', () => openPlatformModal("https://www.trendyol.com/s/trendyol-yemek/restoranlar/212061#bu-restoranin-en-sevilenleri"));
    

    document.getElementById('btnYemeksepeti').addEventListener('click', () => openPlatformModal("https://www.yemeksepeti.com/restaurant/hk8c/olimpiyat-kokorec-and-fast-food-hk8c"));
    document.getElementById('btnGetir').addEventListener('click', () => openPlatformModal("https://getir.com/yemek/restoran/olimpiyat-kokorec-yamanevler-mah-umraniye-istanbul/?adTrackingId="));
    document.getElementById('btnMigros').addEventListener('click', () => openPlatformModal("https://www.migros.com.tr/yemek/olimpiyat-kokorec-doner-umraniye-yamanevler-mah-st-252d3"));
   
    function setPositionByIndex() {
        if (campaignUrls.length === 0) return;
        const sliderContainer = document.querySelector('#campaignSlider');
        const wrapper = document.querySelector('#campaignSlider .slide-wrapper');
        if (!wrapper || !sliderContainer) return;
        const slideWidth = sliderContainer.clientWidth; 
        wrapper.scrollLeft = currentSlide * slideWidth;
        const dots = document.querySelectorAll('#campaignSlider .dot');
        dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
    }
    function startSliderInterval() {
        if (sliderInterval) clearInterval(sliderInterval);
        if (campaignUrls.length > 1) {
            sliderInterval = setInterval(() => {
                const nextSlide = (currentSlide + 1) % campaignUrls.length;
                goToSlide(nextSlide);
            }, 5000); 
        }
    }
    function goToSlide(index) {
        if (campaignUrls.length === 0) return;
        currentSlide = index;
        setPositionByIndex();
    }
    function handleScroll() {
        const wrapper = document.querySelector('#campaignSlider .slide-wrapper');
        const sliderContainer = document.querySelector('#campaignSlider');
        if (!wrapper || !sliderContainer) return;
        const scrollLeft = wrapper.scrollLeft;
        const slideWidth = sliderContainer.clientWidth;
        const newSlideIndex = Math.round(scrollLeft / slideWidth);
        if (newSlideIndex !== currentSlide) {
            currentSlide = newSlideIndex;
            const dots = document.querySelectorAll('#campaignSlider .dot');
            dots.forEach((dot, i) => dot.classList.toggle('active', i === currentSlide));
            startSliderInterval(); 
        }
    }

    function renderCampaignSlider() {
        if (campaignUrls.length === 0) {
            campaignSliderSection.innerHTML = '';
            campaignSliderSection.parentElement.classList.add('hidden');
            return;
        }
        campaignSliderSection.parentElement.classList.remove('hidden');
        const slidesHtml = campaignUrls.map((c, index) => {
            const priceHtml = c.price ? `<div class="campaign-price-overlay">${c.price}â‚º</div>` : '';
            return `<div class="slide"><img src="${c.url}" alt="Kampanya GÃ¶rseli" class="rounded-xl">${priceHtml}</div>`;
        }).join('');
        const dotsHtml = campaignUrls.map((_, i) => `<div class="dot ${i === currentSlide ? 'active' : ''}" data-index="${i}"></div>`).join('');
        
        campaignSliderSection.innerHTML = `<div class="slider-container"><div class="slide-wrapper" style="width: 100%;">${slidesHtml}</div><div class="slider-dots">${dotsHtml}</div></div>`;

        const sliderWrapper = document.querySelector('#campaignSlider .slide-wrapper');
        if (sliderWrapper) sliderWrapper.addEventListener('scroll', handleScroll, { passive: true });
        
        document.querySelectorAll('#campaignSlider .dot').forEach(dot => {
            dot.addEventListener('click', (e) => {
                goToSlide(parseInt(e.target.dataset.index));
                startSliderInterval(); 
            });
        });
        goToSlide(currentSlide);
        startSliderInterval();
    }
    
    function formatRelativeDate(timestamp) {
        if (!timestamp) return "";
        const now = Date.now();
        const diffTime = now - timestamp; 
        const diffMinutes = Math.floor(diffTime / 60000);
        const diffHours = Math.floor(diffMinutes / 60);
        const diffDays = Math.floor(diffHours / 24);
        const t = language === 'TR' ? {
            min: (m) => `${m} dakika Ã¶nce`, hour: (h) => `${h} saat Ã¶nce`, day: (d) => `${d} gÃ¼n Ã¶nce`, today: 'BugÃ¼n', yesterday: 'DÃ¼n', week: '1 hafta Ã¶nce', date: (d, m, y) => `${d}.${m}.${y}`
        } : {
            min: (m) => `${m} minutes ago`, hour: (h) => `${h} hours ago`, day: (d) => `${d} days ago`, today: 'Today', yesterday: 'Yesterday', week: '1 week ago', date: (d, m, y) => `${d}/${m}/${y}`
        };

        if (diffMinutes < 60) return diffMinutes < 5 ? t.today : t.min(diffMinutes);
        if (diffHours < 24) return t.hour(diffHours);
        if (diffDays === 1) return t.yesterday;
        if (diffDays <= 7) return t.day(diffDays);
        if (diffDays <= 14) return t.week;
        const date = new Date(timestamp);
        return t.date(String(date.getDate()).padStart(2,'0'), String(date.getMonth()+1).padStart(2,'0'), date.getFullYear());
    }

    function transformProducts(dataSnapshot) { 
      const productsArray = [];
      dataSnapshot.forEach(childSnapshot => {
        const product = childSnapshot.val();
        product.key = childSnapshot.key;
        product.lastUpdated = product.lastUpdated || Date.now(); 
        productsArray.push(product);
      });
      productsArray.sort((a, b) => (a.order === undefined ? 9999 : a.order) - (b.order === undefined ? 9999 : b.order));
      return productsArray;
    }
    
    function trackVisitor() {
        const today = new Date().toISOString().slice(0, 10); 
        const counterRef = visitorsRef.child(today);
        counterRef.once('value', snapshot => {}); 
        counterRef.transaction(currentCount => { return (currentCount || 0) + 1; });
    }
    
    function setupFirebaseListener() {
        productsRef.on('value', (snapshot) => {
            products = snapshot.exists() ? transformProducts(snapshot) : [];
            updateLanguageContent(); 
        }, (error) => {
            console.error("Firebase hata:", error);
            alert("MenÃ¼ yÃ¼klenemedi.");
        });
        
        campaignsRef.on('value', (snapshot) => {
             campaignUrls = [];
             snapshot.forEach(childSnapshot => {
                 const campaign = childSnapshot.val();
                 campaign.key = childSnapshot.key;
                 campaignUrls.push(campaign);
             });
             campaignUrls.sort((a, b) => (a.order === undefined ? 9999 : a.order) - (b.order === undefined ? 9999 : b.order));
             currentSlide = 0; 
             renderCampaignSlider();
        });
    }

    function renderMenu(category='TÃ¼mÃ¼'){
      menuContainer.innerHTML='';
      const filtered = category==='TÃ¼mÃ¼'?products.filter(p=>p.category!='Ä°letiÅŸim'):products.filter(p=>p.category===category);

      filtered.forEach(p=>{
        const card=document.createElement('div');
        card.className='bg-white rounded-xl shadow p-4 flex flex-col hover:shadow-lg transition-shadow duration-200';
        const name = language==='TR'?p.name:p.nameEN||p.name;
        const desc = language==='TR'?p.desc:p.descEN||p.desc||'';
        const priceUpdateText = formatRelativeDate(p.lastUpdated); 
        const lastUpdateLabel = language === 'TR' ? 'Fiyat gÃ¼ncellendi:' : 'Price updated:';
        const imageUrl = p.image && p.image.trim() !== '' ? p.image : 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="sans-serif" font-size="10" fill="%239ca3af">GÃ¶rsel YÃ¼klenmedi</text></svg>';
        const imageClass = p.image && p.image.trim() !== '' ? 'cursor-pointer' : 'opacity-70';
        
        let finalPrice = p.price;
        if (p.category !== 'Ä°Ã§ecekler' && !isNaN(parseFloat(p.price))) { finalPrice = parseFloat(p.price); }

        card.innerHTML=`
          <img src='${imageUrl}' alt='${name}' class='w-full h-40 object-cover rounded-lg mb-3 ${imageClass}'>
          <h3 class='font-bold text-xl mb-1'>${name}</h3>
          <p class='text-gray-600 text-sm mb-3 flex-grow'>${desc}</p>
          <div class="flex justify-between items-end">
            <p class='bg-red-100 text-red-700 inline-block px-3 py-1 rounded-full font-bold text-lg self-start'>${finalPrice} â‚º</p>
            <p class='price-update-info text-right'>${lastUpdateLabel} ${priceUpdateText}</p>
          </div>
        `;
        if (p.image && p.image.trim() !== '') {
            card.querySelector('img').addEventListener('click',()=>{modalImage.src=p.image;imageModal.classList.remove('hidden');});
        }
        menuContainer.appendChild(card);
      });
    }

    function createCategoryTabs(){
        const tabButtonsContainer = document.getElementById('categoryTabs');
        tabButtonsContainer.innerHTML = '';
        const categoriesToIterate = categoriesTR;

        categoriesToIterate.forEach((catTR, index) => {
            let btn = document.createElement('button');
            const catName = language === 'TR' ? catTR : categoriesEN[index];
            btn.className='tabBtn px-3 py-1 rounded whitespace-nowrap transition-colors duration-150 hover:bg-red-200';
            btn.dataset.category=catTR;
            btn.textContent=catName;
            if(catTR==='TÃ¼mÃ¼') btn.classList.add('active-tab');

            btn.addEventListener('click',()=>{
                document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active-tab'));
                btn.classList.add('active-tab');
                const categoryKey = btn.dataset.category;
                if(categoryKey==='Ä°letiÅŸim'){
                    menuContainer.innerHTML='';
                    campaignSliderSection.parentElement.classList.add('hidden'); 
                    contactSection.classList.remove('hidden');
                } else {
                    contactSection.classList.add('hidden');
                    renderCampaignSlider(); 
                    renderMenu(categoryKey);
                }
            });
            tabButtonsContainer.appendChild(btn);
        });
    }

    function updateLanguageContent() {
        const langTR = document.getElementById('langTR');
        const langEN = document.getElementById('langEN');
        const contactTitle = document.getElementById('contactTitle');
        const contactAddress = document.getElementById('contactAddress');
        
        if (language === 'TR') {
            langTR.style.fontWeight = 'bold'; langEN.style.fontWeight = 'normal';
            contactTitle.textContent = 'Ä°letiÅŸim';
            contactAddress.innerHTML = 'ğŸ“ Yamanevler Mah. AlemdaÄŸ Caddesi No 159 D<br>Olimpiyat KokoreÃ§ Ãœmraniye - Ä°stanbul';
        } else { 
            langTR.style.fontWeight = 'normal'; langEN.style.fontWeight = 'bold';
            contactTitle.textContent = 'Contact';
            contactAddress.innerHTML = 'ğŸ“ Yamanevler Mah. AlemdaÄŸ Caddesi No 159 D<br>Olimpiyat KokoreÃ§ Ãœmraniye - Istanbul (Turkey)';
        }
        createCategoryTabs();
        const activeTab = document.querySelector('.tabBtn.active-tab');
        const activeCategoryKey = activeTab ? activeTab.dataset.category : 'TÃ¼mÃ¼';
        if (activeCategoryKey === 'Ä°letiÅŸim') {
            menuContainer.innerHTML = ''; campaignSliderSection.parentElement.classList.add('hidden'); contactSection.classList.remove('hidden');
        } else {
            contactSection.classList.add('hidden'); renderCampaignSlider(); renderMenu(activeCategoryKey);
        }
    }
    
    // --- YORUM MODALI MANTIÄI ---
    const RATING_INTERVALS = [6000, 12000, 18000]; 
    function isModalPermanentlyDisabled() { return localStorage.getItem('olimpiyat_rated') === 'true'; }
    function showRatingModal() {
        if (isModalPermanentlyDisabled()) return;
        if (sessionStorage.getItem('olimpiyat_rated_session_closed') !== 'true') ratingModal.classList.remove('hidden');
    }
    function setupIntervals() {
        if (isModalPermanentlyDisabled()) return;
        RATING_INTERVALS.forEach(delay => {
            setTimeout(() => {
                if (ratingModal.classList.contains('hidden') && !isModalPermanentlyDisabled()) showRatingModal();
            }, delay);
        });
    }

    goToRatingLink.addEventListener('click', () => { localStorage.setItem('olimpiyat_rated', 'true'); ratingModal.classList.add('hidden'); });
    closeRatingModal.addEventListener('click', () => { sessionStorage.setItem('olimpiyat_rated_session_closed', 'true'); ratingModal.classList.add('hidden'); });
    floatingRatingButton.addEventListener('click', () => { ratingModal.classList.remove('hidden'); });

    // --- EVENT LISTENERS ---
    document.getElementById('langTR').addEventListener('click',()=>{ language='TR'; updateLanguageContent(); });
    document.getElementById('langEN').addEventListener('click',()=>{ language='EN'; updateLanguageContent(); });
    document.getElementById('imageModal').addEventListener('click',()=>document.getElementById('imageModal').classList.add('hidden'));
    
    document.getElementById('closeAdminLogin').addEventListener('click',()=>document.getElementById('adminLoginModal').classList.add('hidden'));
    document.getElementById('checkPassword').addEventListener('click',()=>{
        const passwordInput = document.getElementById('passwordInput');
        const loginError = document.getElementById('loginError');
        const adminLoginModal = document.getElementById('adminLoginModal');
        if(passwordInput.value==='admin123'){ 
            adminLoginModal.classList.add('hidden');
            window.location.href = 'admin.html'; 
        } else { loginError.classList.remove('hidden'); }
    });

    document.addEventListener('DOMContentLoaded', () => {
      setupFirebaseListener(); 
      trackVisitor(); 
      window.addEventListener('resize', setPositionByIndex); 
      setupIntervals();
    });
  </script>
</body>
</html>
