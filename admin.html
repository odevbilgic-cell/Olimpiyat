<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¶netici Paneli | Olimpiyat KokoreÃ§</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

    <style>
        body { background-color: #f3f4f6; }
        .tab-button.active { background-color: #fb923c; color: white; }
        /* SÄ±ralama ModÃ¼lÃ¼ Ä°Ã§in Stiller */
        .sortable-item { cursor: grab; }
        .sortable-item:active { cursor: grabbing; }
        .sortable-ghost {
            opacity: 0.4;
            background: #ffe6cc; 
            border: 2px dashed #fb923c;
        }
        /* Kampanya GÃ¶rseli Ã–nizlemeleri Ä°Ã§in Yeni Stil */
        .campaign-image-preview {
            width: 100%;
            height: 120px; 
            object-fit: cover; 
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            border: 1px solid #d1d5db;
        }
        /* Kampanya Listesindeki GÃ¶rseller iÃ§in */
        .campaign-item-img {
            width: 80px;
            height: 45px; 
            object-fit: cover;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
            margin-right: 0.75rem;
        }
        .price-box-preview-img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            border-radius: 50%;
            margin-top: 8px;
            border: 2px solid #fb923c;
            background-color: white;
            padding: 5px;
        }
    </style>
</head>
<body>
    <div class="flex h-screen">
        <div class="w-64 bg-orange-600 text-white flex flex-col p-4 shadow-xl">
            <h1 class="text-3xl font-bold mb-8 border-b border-orange-400 pb-2">Admin Panel</h1>
            <button id="showProducts" class="tab-button active text-left p-3 rounded hover:bg-orange-500 transition mb-2">
                ğŸ“¦ ÃœrÃ¼n YÃ¶netimi
            </button>
            <button id="showSorting" class="tab-button text-left p-3 rounded hover:bg-orange-500 transition mb-2">
                â¬†ï¸ ÃœrÃ¼n SÄ±ralama AyarÄ±
            </button>
            <button id="showCampaigns" class="tab-button text-left p-3 rounded hover:bg-orange-500 transition mb-2">
                ğŸ–¼ï¸ Kampanya GÃ¶rselleri
            </button>
            <button id="showAddProduct" class="tab-button text-left p-3 rounded hover:bg-orange-500 transition mb-2">
                â• Yeni ÃœrÃ¼n Ekle
            </button>
            <button id="showBulkUpdate" class="tab-button text-left p-3 rounded hover:bg-orange-500 transition mb-2">
                ğŸ’¸ Toplu Fiyat DeÄŸiÅŸtirme
            </button>
            <button id="showStats" class="tab-button text-left p-3 rounded hover:bg-orange-500 transition mb-2">
                ğŸ“Š Ä°statistikler
            </button>
            <a href="index.html" class="mt-auto p-3 bg-red-500 text-center rounded hover:bg-red-600 transition">
                Ã‡Ä±kÄ±ÅŸ Yap
            </a>
        </div>

        <main class="flex-1 p-8 overflow-y-auto">
            <div id="contentContainer">
                </div>
        </main>
    </div>

    <div id="editProductModal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50">
        <div class="bg-white rounded-xl shadow-lg p-6 w-[500px] relative max-h-[90vh] overflow-y-auto">
            <button id="closeEditProductModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800">âœ–</button>
            <h2 class="text-xl font-bold mb-3 text-orange-600">ÃœrÃ¼n DÃ¼zenle</h2>
            
            <input type="hidden" id="editProductKey" />
            
            <div class="flex flex-col gap-3">
                <div class="p-3 border rounded-lg bg-gray-50">
                    <h3 class="font-semibold mb-2">GÃ¶rsel DÃ¼zenleme</h3>
                    <img id="editImagePreview" class="w-full h-32 object-cover rounded-lg mb-2 border border-gray-300" src="" alt="ÃœrÃ¼n GÃ¶rseli Ã–nizleme">
                    <button id="uploadEditImageBtn" class="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition w-full">Yeni GÃ¶rsel YÃ¼kle</button>
                    <input type="hidden" id="editImageURL" value="" />
                </div>

                <input id="editName" placeholder="ÃœrÃ¼n AdÄ± (TR)" class="border p-2 rounded" />
                <input id="editNameEN" placeholder="Product Name (EN)" class="border p-2 rounded" />
                <input id="editDesc" placeholder="AÃ§Ä±klama (TR)" class="border p-2 rounded" />
                <input id="editDescEN" placeholder="Description (EN)" class="border p-2 rounded" />
                <input id="editPrice" type="number" placeholder="Fiyat (â‚º)" class="border p-2 rounded" />
                <select id="editCategory" class="border p-2 rounded"></select>

                <button id="saveEditProduct" class="bg-green-500 text-white px-4 py-2 rounded mt-4 hover:bg-green-600 transition">DeÄŸiÅŸiklikleri Kaydet</button>
            </div>
        </div>
    </div>


    <script>
        // --- Sabitler ve Ayarlar ---
        const firebaseConfig = {
            apiKey: "AIzaSyDcYNF0hMow-y1MuV3GXLG9vY_MK0tJTGs",
            authDomain: "olimpiyatkokorecmenu.firebaseapp.com",
            projectId: "olimpiyatkokorecmenu",
            messagingSenderId: "987017604417",
            appId: "1:987017604417:web:b6c4858712dc66d14745c0",
            databaseURL: "https://olimpiyatkokorecmenu-default-rtdb.europe-west1.firebasedatabase.app" 
        };
        const CLOUDINARY_CLOUD_NAME = 'dtkrwqofx';      
        const CLOUDINARY_UPLOAD_PRESET = 'olimpiyat_menu'; 

        // Firebase'i baÅŸlat
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const productsRef = database.ref('products');
        const visitorsRef = database.ref('visitors');
        const campaignsRef = database.ref('campaigns'); 
        const campaignInfoRef = database.ref('campaign_info'); 
        const priceBoxUrlRef = database.ref('campaign_info/price_box_url'); // YENÄ°: Fiyat KutucuÄŸu GÃ¶rseli URL'si
        
        let products = []; 
        let campaignUrls = []; 
        let campaignPriceText = ""; 
        let campaignPriceBoxUrl = ""; // YENÄ°: Fiyat KutucuÄŸu URL'si iÃ§in deÄŸiÅŸken
        const categoriesTR = ['MenÃ¼ler', 'KokoreÃ§', 'Tavuk KokoreÃ§', 'Tavuk DÃ¶ner', 'Patso', 'KÃ¶fte', 'CiÄŸer', 'Hamburger', 'Tost', 'Midye', 'Yan Lezzetler', 'Ä°Ã§ecekler']; 
        
        // --- HTML Element TanÄ±mlamalarÄ± ---
        const contentContainer = document.getElementById('contentContainer');
        const showProductsBtn = document.getElementById('showProducts');
        const showSortingBtn = document.getElementById('showSorting'); 
        const showCampaignsBtn = document.getElementById('showCampaigns'); 
        const showAddProductBtn = document.getElementById('showAddProduct');
        const showBulkUpdateBtn = document.getElementById('showBulkUpdate');
        const showStatsBtn = document.getElementById('showStats');
        const tabButtons = document.querySelectorAll('.tab-button');
        const editProductModal = document.getElementById('editProductModal');
        const closeEditProductModal = document.getElementById('closeEditProductModal');
        const editImageURLInput = document.getElementById('editImageURL');
        const editImagePreview = document.getElementById('editImagePreview');
        const uploadEditImageBtn = document.getElementById('uploadEditImageBtn');
        const saveEditProductButton = document.getElementById('saveEditProduct');
        
        // --- MODÃœL VE UI YÃ–NETÄ°MÄ° ---

        function setActiveTab(buttonId) {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            document.getElementById(buttonId).classList.add('active');
        }

        function loadModule(htmlContent) {
            contentContainer.innerHTML = htmlContent;
        }

        function openCloudinaryWidget(urlInput, previewImg, uploadPreset = CLOUDINARY_UPLOAD_PRESET) {
            if (!CLOUDINARY_CLOUD_NAME || !uploadPreset) {
                alert("Hata: Cloudinary ayarlarÄ± eksik.");
                return;
            }

            const widget = window.cloudinary.createUploadWidget(
                {
                    cloudName: CLOUDINARY_CLOUD_NAME,
                    uploadPreset: uploadPreset, 
                    sources: ['local', 'url', 'camera'], 
                },
                (error, result) => {
                    if (!error && result && result.event === "success") {
                        const url = result.info.secure_url;
                        urlInput.value = url; 
                        previewImg.src = url; 
                        previewImg.classList.remove('hidden'); 
                        alert("GÃ¶rsel yÃ¼klendi ve URL kaydedildi.");
                    } else if (error) {
                        console.error("Cloudinary yÃ¼kleme hatasÄ±:", error);
                        alert("GÃ¶rsel yÃ¼klenirken bir hata oluÅŸtu: " + error.message);
                    }
                }
            );
            widget.open();
        }
        
        async function updateProductInFirebase(key, updates) {
            updates.lastUpdated = Date.now(); 
            await productsRef.child(key).update(updates);
        }

        async function deleteProductFromFirebase(key) {
            await productsRef.child(key).remove();
        }
        
        async function deleteCampaignUrl(key) {
             await campaignsRef.child(key).remove();
        }
        
        function sortProductsByOrder(productsArray) {
            return productsArray.sort((a, b) => (a.order === undefined ? 9999 : a.order) - (b.order === undefined ? 9999 : b.order));
        }

        // --- MODÃœL: ÃœRÃœN YÃ–NETÄ°MÄ° (PRODUCTS) ---
        function renderProductsModule() {
            setActiveTab('showProducts');
            loadModule(`
                <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ“¦ ÃœrÃ¼n YÃ¶netimi</h2>
                <div class="flex gap-4 mb-4">
                    <select id="filterCategory" class="border p-2 rounded flex-1">
                        <option value="TÃ¼mÃ¼">TÃ¼mÃ¼</option>
                        ${categoriesTR.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                    </select>
                </div>
                <ul id="productList" class="flex flex-col gap-3">
                    <li class="p-4 bg-white rounded shadow text-gray-500">ÃœrÃ¼nler yÃ¼kleniyor...</li>
                </ul>
            `);
            const filterSelect = document.getElementById('filterCategory');
            filterSelect.addEventListener('change', () => renderProductList(filterSelect.value));
            if (products.length > 0) {
                 renderProductList(filterSelect.value);
            }
        }

        function renderProductList(filter='TÃ¼mÃ¼') {
            const listEl = document.getElementById('productList');
            if (!listEl) return;
            listEl.innerHTML = '';
            
            const sortedProducts = sortProductsByOrder([...products]); 
            const filtered = filter === 'TÃ¼mÃ¼' ? sortedProducts : sortedProducts.filter(p => p.category === filter);

            if (filtered.length === 0) {
                listEl.innerHTML = '<li class="p-4 bg-white rounded shadow text-gray-500">Bu kategoride Ã¼rÃ¼n bulunmamaktadÄ±r.</li>';
                return;
            }

            filtered.forEach((p) => {
                const item = document.createElement('li');
                item.className = 'flex justify-between items-center bg-white p-3 rounded border shadow-sm';
                item.innerHTML = `
                    <span class="font-medium text-base">${p.name} (${p.category}) - ${p.price} â‚º</span>
                    <div>
                        <button data-key="${p.key}" class="editBtn bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition mr-2">DÃ¼zenle</button>
                        <button data-key="${p.key}" class="deleteBtn bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition">Sil</button>
                    </div>
                `;
                listEl.appendChild(item);
            });

            document.querySelectorAll('.deleteBtn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const productKeyToDelete = e.target.dataset.key;
                    if (confirm("Bu Ã¼rÃ¼nÃ¼ silmek istediÄŸinizden emin misiniz?")) {
                        try { await deleteProductFromFirebase(productKeyToDelete); alert("ÃœrÃ¼n silindi."); } 
                        catch (error) { alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z oldu: " + error.message); }
                    }
                });
            });
            document.querySelectorAll('.editBtn').forEach(btn => btn.addEventListener('click', (e) => openEditModal(e.target.dataset.key)));
        }

        // --- MODÃœL: ÃœRÃœN SIRALAMA AYARI (SORTING) ---
        
        function renderSortingModule() {
            if (typeof Sortable === 'undefined') {
                alert("Hata: ÃœrÃ¼n sÄ±ralama Ã¶zelliÄŸi iÃ§in gerekli kÃ¼tÃ¼phane (Sortable.js) yÃ¼klenemedi. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin.");
                return;
            }
            
            setActiveTab('showSorting');
            loadModule(`
                <h2 class="text-3xl font-bold text-gray-800 mb-6">â¬†ï¸ ÃœrÃ¼n SÄ±ralama AyarÄ±</h2>
                <div class="p-6 bg-white rounded-lg shadow-md max-w-2xl">
                    <p class="mb-4 text-gray-600">ÃœrÃ¼nleri sÃ¼rÃ¼kleyip bÄ±rakarak menÃ¼deki sÄ±ralamasÄ±nÄ± deÄŸiÅŸtirebilirsiniz. Bu ayar tÃ¼m dillerde geÃ§erli olacaktÄ±r.</p>
                    
                    <label class="block mb-2 font-semibold text-sm">SÄ±ralanacak Kategori SeÃ§in:</label>
                    <select id="sortCategory" class="border p-2 rounded w-full mb-6">
                        <option value="">-- Kategori SeÃ§iniz --</option>
                        <option value="TÃ¼mÃ¼">TÃ¼mÃ¼ (TÃ¼m ÃœrÃ¼nler)</option> ${categoriesTR.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                    </select>

                    <ul id="sortableList" class="flex flex-col gap-2 p-2 border rounded bg-gray-50 min-h-[100px]">
                        <li class="text-gray-500 text-center py-4">LÃ¼tfen yukarÄ±dan bir kategori seÃ§iniz.</li>
                    </ul>
                    
                    <button id="saveSorting" class="mt-6 bg-green-500 text-white px-4 py-3 rounded text-lg font-semibold hover:bg-green-600 transition w-full hidden">Yeni SÄ±ralamayÄ± Kaydet</button>
                    <p id="sortingStatus" class="mt-4 text-center text-sm text-green-600 hidden"></p>
                </div>
            `);
            
            // Event Listeners
            const sortCategorySelect = document.getElementById('sortCategory');
            sortCategorySelect.addEventListener('change', (e) => loadSortableList(e.target.value));
            document.getElementById('saveSorting').addEventListener('click', saveSortingOrder);
        }
        
        // Kategori seÃ§ildiÄŸinde sÃ¼rÃ¼kle-bÄ±rak listesini yÃ¼kler
        function loadSortableList(category) {
            const listEl = document.getElementById('sortableList');
            const saveBtn = document.getElementById('saveSorting');
            const statusEl = document.getElementById('sortingStatus');
            statusEl.classList.add('hidden');
            saveBtn.classList.add('hidden');
            listEl.innerHTML = '';
            
            if (!category || products.length === 0) {
                listEl.innerHTML = `<li class="text-gray-500 text-center py-4">${products.length === 0 ? 'ÃœrÃ¼n verileri yÃ¼kleniyor...' : 'LÃ¼tfen yukarÄ±dan bir kategori seÃ§iniz.'}</li>`;
                return;
            }
            
            const filteredProducts = category === 'TÃ¼mÃ¼'
                ? products
                : products.filter(p => p.category === category);
            
            const filteredAndSorted = sortProductsByOrder(filteredProducts);


            if (filteredAndSorted.length === 0) {
                listEl.innerHTML = `<li class="text-gray-500 text-center py-4">"${category}" kategorisinde Ã¼rÃ¼n bulunmamaktadÄ±r.</li>`;
                return;
            }
            
            filteredAndSorted.forEach((p) => {
                const item = document.createElement('li');
                item.className = 'sortable-item flex justify-between items-center bg-white p-3 rounded shadow-sm border border-gray-200';
                item.dataset.id = p.key; 
                item.innerHTML = `
                    <span class="text-gray-400 mr-3">â˜°</span>
                    <span class="font-medium text-base flex-1">${p.name}</span>
                    <span class="text-orange-600 font-semibold">${p.price} â‚º</span>
                `;
                listEl.appendChild(item);
            });
            
            saveBtn.classList.remove('hidden');

            Sortable.create(listEl, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: function (evt) {
                    statusEl.textContent = 'SÄ±ralama deÄŸiÅŸtirildi. Kaydet butonuna basmayÄ± unutmayÄ±n!';
                    statusEl.classList.remove('hidden');
                    statusEl.classList.remove('text-green-600');
                    statusEl.classList.add('text-red-600');
                },
            });
        }
        
        // Yeni sÄ±ralama dÃ¼zenini (order deÄŸerlerini) Firebase'e kaydeder
        async function saveSortingOrder() {
            const listEl = document.getElementById('sortableList');
            const items = listEl.children;
            const updates = {};
            const statusEl = document.getElementById('sortingStatus');
            let changesMade = 0;
            
            if (items.length === 0) return;
            
            for (let i = 0; i < items.length; i++) {
                const productKey = items[i].dataset.id;
                const newOrderValue = i; 
                
                const currentProduct = products.find(p => p.key === productKey);
                
                if (currentProduct && currentProduct.order !== newOrderValue) {
                    updates[`products/${productKey}/order`] = newOrderValue; 
                    changesMade++;
                }
            }
            
            if (changesMade === 0) {
                 statusEl.textContent = 'Herhangi bir sÄ±ralama deÄŸiÅŸikliÄŸi tespit edilmedi.';
                 statusEl.classList.remove('text-red-600');
                 statusEl.classList.add('text-green-600');
                 statusEl.classList.remove('hidden');
                 return;
            }
            
            if (!confirm(`${changesMade} Ã¼rÃ¼nÃ¼n sÄ±ralamasÄ± gÃ¼ncellenecektir. OnaylÄ±yor musunuz?`)) {
                return;
            }

            try {
                await database.ref().update(updates); 
                
                statusEl.textContent = `${changesMade} Ã¼rÃ¼n sÄ±ralamasÄ± baÅŸarÄ±yla kaydedildi.`;
                statusEl.classList.remove('text-red-600');
                statusEl.classList.add('text-green-600');
                statusEl.classList.remove('hidden');
                
                const currentCategory = document.getElementById('sortCategory').value;
                loadSortableList(currentCategory); 

            } catch (error) {
                statusEl.textContent = 'SÄ±ralamayÄ± kaydetme baÅŸarÄ±sÄ±z oldu: ' + error.message;
                statusEl.classList.add('text-red-600');
                statusEl.classList.remove('text-green-600');
                statusEl.classList.remove('hidden');
            }
        }

        // --- YENÄ° MODÃœL: KAMPANYA GÃ–RSELLERÄ° YÃ–NETÄ°MÄ° ---

        function renderCampaignModule() {
            setActiveTab('showCampaigns');
            loadModule(`
                <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ–¼ï¸ Kampanya GÃ¶rselleri YÃ¶netimi</h2>
                <div class="p-6 bg-white rounded-lg shadow-md max-w-2xl">
                    <p class="mb-4 text-gray-600">Bu gÃ¶rseller ana sayfadaki otomatik dÃ¶nen banner (slider) alanÄ±nda kullanÄ±lÄ±r.</p>

                    <div class="border p-4 mb-6 rounded-lg bg-red-50">
                        <h3 class="font-bold mb-3 text-red-700">ğŸ“Œ Kampanya Fiyat KutucuÄŸu GÃ¶rseli</h3>
                        <p class="text-sm text-gray-600 mb-3">Bu gÃ¶rsel, kampanyalarÄ±n Ã¼zerinde sabit duran ÅŸÄ±k fiyat etiketidir. (Ã–rn: SarÄ±-Siyah Daire)</p>
                        
                        <img id="priceBoxImagePreview" class="price-box-preview-img ${campaignPriceBoxUrl ? '' : 'hidden'}" src="${campaignPriceBoxUrl}" alt="Fiyat KutucuÄŸu Ã–nizleme">
                        
                        <button id="uploadPriceBoxImageBtn" class="mt-3 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition w-full font-semibold">Kutucuk GÃ¶rseli YÃ¼kle / DeÄŸiÅŸtir</button>
                        <input type="hidden" id="priceBoxImageURL" value="${campaignPriceBoxUrl}" />
                    </div>
                    
                    <div class="border p-4 mb-6 rounded-lg bg-yellow-50">
                        <h3 class="font-bold mb-3 text-red-600">Toplu Kampanya Fiyat Metni</h3>
                        <p class="text-sm text-gray-600 mb-3">Bu metin, yÃ¼klediÄŸiniz **kutucuk gÃ¶rseli iÃ§inde** gÃ¶sterilir. (Ã–rn: "250 â‚º", "%20 Ä°ndirim")</p>
                        <input id="campaignPriceTextInput" type="text" placeholder="Ã–rn: 250 â‚º" value="${campaignPriceText}" class="border p-2 rounded w-full mb-3" />
                        <button id="saveCampaignPriceTextBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition w-full font-semibold">Fiyat Metnini Kaydet</button>
                        <p id="campaignPriceStatus" class="mt-2 text-sm text-green-600 hidden"></p>
                    </div>

                    <div class="border p-4 mb-6 rounded-lg bg-gray-50">
                        <h3 class="font-bold mb-3 text-orange-600">Yeni Banner GÃ¶rseli YÃ¼kle</h3>
                        <p class="text-sm text-gray-600 mb-3">Ã–nerilen gÃ¶rsel boyutu: GeniÅŸ ve yatay (Ã–rn: 800x300 piksel).</p>
                        <button id="uploadNewCampaignImageBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition w-full">GÃ¶rsel YÃ¼kle (Cloudinary)</button>
                        <img id="newCampaignImagePreview" class="campaign-image-preview hidden" src="" alt="Yeni Kampanya GÃ¶rseli Ã–nizleme">
                        <input type="hidden" id="newCampaignImageURL" value="" />
                        <button id="addCampaignUrlBtn" class="mt-3 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition w-full hidden">GÃ¶rseli Listeye Ekle</button>
                    </div>

                    <h3 class="font-bold text-xl mb-3 text-gray-800">Mevcut Kampanya GÃ¶rselleri (${campaignUrls.length} Adet)</h3>
                    <ul id="campaignList" class="flex flex-col gap-3 p-2 border rounded bg-gray-50 min-h-[50px]">
                        </ul>
                </div>
            `);
            
            // Event Listeners (Fiyat KutucuÄŸu)
            const priceBoxUrlInput = document.getElementById('priceBoxImageURL');
            const priceBoxPreview = document.getElementById('priceBoxImagePreview');

            document.getElementById('uploadPriceBoxImageBtn').addEventListener('click', (e) => {
                e.preventDefault();
                openCloudinaryWidget(priceBoxUrlInput, priceBoxPreview);
                // Kutucuk gÃ¶rseli yÃ¼klendiÄŸinde Firebase'e kaydet
                priceBoxUrlInput.addEventListener('change', async () => {
                    const newUrl = priceBoxUrlInput.value.trim();
                    if(newUrl) {
                         try {
                             await priceBoxUrlRef.set(newUrl);
                             campaignPriceBoxUrl = newUrl; // Global deÄŸiÅŸkeni gÃ¼ncelle
                             alert("Kutucuk gÃ¶rseli baÅŸarÄ±yla gÃ¼ncellendi.");
                         } catch (error) {
                             alert("Kutucuk gÃ¶rselini kaydetme baÅŸarÄ±sÄ±z oldu: " + error.message);
                         }
                    }
                }, { once: true });
            });


            // Event Listeners (Banner GÃ¶rseli YÃ¼kleme ve Silme)
            const urlInput = document.getElementById('newCampaignImageURL');
            const previewImg = document.getElementById('newCampaignImagePreview');
            const addBtn = document.getElementById('addCampaignUrlBtn');
            
            document.getElementById('uploadNewCampaignImageBtn').addEventListener('click', (e) => {
                e.preventDefault();
                openCloudinaryWidget(urlInput, previewImg); 
                addBtn.classList.remove('hidden');
            });

            addBtn.addEventListener('click', addCampaignUrl);
            
            // Kampanya Fiyat Metni Kaydetme OlayÄ±
            document.getElementById('saveCampaignPriceTextBtn').addEventListener('click', saveCampaignPriceText);
            
            renderCampaignList();
            
             // Input deÄŸerlerini Firebase'den gelen veriye gÃ¶re ayarla
            document.getElementById('campaignPriceTextInput').value = campaignPriceText;
        }
        
        // Kampanya Fiyat Metnini Firebase'e kaydeder
        async function saveCampaignPriceText() {
            const textInput = document.getElementById('campaignPriceTextInput');
            const statusEl = document.getElementById('campaignPriceStatus');
            const newText = textInput.value.trim();

            try {
                await campaignInfoRef.child('price_text').set(newText);
                
                campaignPriceText = newText; 
                statusEl.textContent = 'Kampanya fiyat metni baÅŸarÄ±yla kaydedildi!';
                statusEl.classList.remove('hidden', 'text-red-600');
                statusEl.classList.add('text-green-600');
            } catch (error) {
                statusEl.textContent = 'Kaydetme baÅŸarÄ±sÄ±z oldu: ' + error.message;
                statusEl.classList.remove('hidden', 'text-green-600');
                statusEl.classList.add('text-red-600');
            }
            setTimeout(() => statusEl.classList.add('hidden'), 3000);
        }
        
        // Mevcut Kampanya GÃ¶rsellerini Listeler
        function renderCampaignList() {
            const listEl = document.getElementById('campaignList');
            if (!listEl) return;
            listEl.innerHTML = '';

            if (campaignUrls.length === 0) {
                listEl.innerHTML = '<li class="text-gray-500 text-center py-4">HenÃ¼z kampanya gÃ¶rseli eklenmedi.</li>';
                return;
            }
            
            const sortedCampaigns = [...campaignUrls].sort((a, b) => b.timestamp - a.timestamp);

            sortedCampaigns.forEach((c) => {
                const item = document.createElement('li');
                item.className = 'flex items-center bg-white p-3 rounded shadow-sm border border-gray-200';
                item.innerHTML = `
                    <img src="${c.url}" class="campaign-item-img" alt="Kampanya GÃ¶rseli">
                    <span class="text-sm flex-1 truncate">${c.url}</span>
                    <button data-key="${c.key}" class="deleteCampaignBtn bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition ml-3">Sil</button>
                `;
                listEl.appendChild(item);
            });

            document.querySelectorAll('.deleteCampaignBtn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    const keyToDelete = e.target.dataset.key;
                    if (confirm("Bu kampanya gÃ¶rselini silmek istediÄŸinizden emin misiniz?")) {
                        try { 
                            await deleteCampaignUrl(keyToDelete); 
                            alert("Kampanya gÃ¶rseli silindi."); 
                        } catch (error) { 
                            alert("Silme iÅŸlemi baÅŸarÄ±sÄ±z oldu: " + error.message); 
                        }
                    }
                });
            });
        }
        
        // Yeni gÃ¶rsel URL'sini Firebase'e kaydeder
        async function addCampaignUrl() {
            const url = document.getElementById('newCampaignImageURL').value.trim();
            if (!url) {
                alert('LÃ¼tfen Ã¶nce bir gÃ¶rsel yÃ¼kleyin.');
                return;
            }

            try {
                await campaignsRef.push({ url: url, timestamp: Date.now() }); 
                alert("Kampanya gÃ¶rseli baÅŸarÄ±yla listeye eklendi.");
                
                document.getElementById('newCampaignImageURL').value = '';
                document.getElementById('newCampaignImagePreview').src = '';
                document.getElementById('newCampaignImagePreview').classList.add('hidden');
                document.getElementById('addCampaignUrlBtn').classList.add('hidden');
                
            } catch (error) {
                alert("GÃ¶rsel ekleme baÅŸarÄ±sÄ±z oldu: " + error.message);
            }
        }

        // --- MODÃœL: YENÄ° ÃœRÃœN EKLEME (ADD PRODUCT) ---
        function renderAddProductModule() {
            setActiveTab('showAddProduct');
            loadModule(`
                <h2 class="text-3xl font-bold text-gray-800 mb-6">â• Yeni ÃœrÃ¼n Ekle</h2>
                <div class="flex flex-col gap-4 p-6 border rounded-lg bg-white shadow-md max-w-lg">
                    <input id="productName" placeholder="ÃœrÃ¼n AdÄ± (TR)" class="border p-3 rounded" />
                    <input id="productNameEN" placeholder="Product Name (EN) (Opsiyonel)" class="border p-3 rounded" />
                    <input id="productDesc" placeholder="AÃ§Ä±klama (TR)" class="border p-3 rounded" />
                    <input id="productDescEN" placeholder="Description (EN) (Opsiyonel)" class="border p-3 rounded" />
                    <input id="productPrice" type="number" placeholder="Fiyat (â‚º)" class="border p-3 rounded" />
                    <select id="productCategory" class="border p-3 rounded">
                        <option value="">-- Kategori SeÃ§iniz --</option>
                        ${categoriesTR.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                    </select>

                    <div class="p-4 border rounded-lg bg-gray-50">
                        <h3 class="font-semibold mb-2">GÃ¶rsel YÃ¼kle (Opsiyonel)</h3>
                        <button id="uploadNewImageBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition w-full">GÃ¶rsel YÃ¼kle</button>
                        <img id="newImagePreview" class="w-full h-32 object-cover rounded-lg mt-3 border border-gray-300" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23e5e7eb'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='10' fill='%236b7280'>GÃ¶rsel Yok</text></svg>" alt="Yeni GÃ¶rsel Ã–nizleme">
                        <input type="hidden" id="productImageURL" value="" />
                    </div>
                    
                    <button id="addProduct" class="bg-orange-500 text-white px-4 py-3 rounded text-lg font-semibold hover:bg-orange-600 transition">ÃœrÃ¼nÃ¼ Kaydet</button>
                </div>
            `);
            // Event Listener'lar
            document.getElementById('uploadNewImageBtn').addEventListener('click', (e) => {
                e.preventDefault();
                openCloudinaryWidget(document.getElementById('productImageURL'), document.getElementById('newImagePreview'));
            });
            document.getElementById('addProduct').addEventListener('click', addProduct);

            document.getElementById('newImagePreview').src = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23e5e7eb'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='10' fill='%236b7280'>GÃ¶rsel Yok</text></svg>";
        }

        async function addProduct() {
            const name = document.getElementById('productName').value.trim();
            const nameEN = document.getElementById('productNameEN').value.trim();
            const desc = document.getElementById('productDesc').value.trim();
            const descEN = document.getElementById('productDescEN').value.trim();
            const price = parseFloat(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            
            let imageURL = document.getElementById('productImageURL').value.trim(); 
            
            if (!imageURL) { imageURL = ''; }

            if (!name || isNaN(price) || !category) { 
                alert('LÃ¼tfen tÃ¼m zorunlu alanlarÄ± (Ad, Fiyat ve Kategori) doldurunuz.'); return; 
            }
            
            const maxOrder = products.length > 0 
                ? Math.max(...products.map(p => p.order === undefined ? 0 : p.order))
                : 0;
            
            const newProduct = {
                name, nameEN: nameEN || name, desc, descEN: descEN || desc,
                price, image: imageURL, category, 
                lastUpdated: Date.now(),
                order: maxOrder + 1 
            };

            try {
                await database.ref('products').push(newProduct); 
                alert(`"${name}" Ã¼rÃ¼nÃ¼ baÅŸarÄ±yla eklendi.`);
                
                document.querySelectorAll('#contentContainer input, #contentContainer select').forEach(el => el.value = '');
                document.getElementById('productImageURL').value = ''; 
                
                const previewImg = document.getElementById('newImagePreview');
                previewImg.src = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100%' height='100%' viewBox='0 0 100 100'><rect width='100' height='100' fill='%23e5e7eb'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='10' fill='%236b7280'>GÃ¶rsel Yok</text></svg>";
                
            } catch (error) {
                alert("Ekleme iÅŸlemi baÅŸarÄ±sÄ±z oldu: " + error.message);
            }
        }

        // --- MODÃœL: TOPLU FÄ°YAT DEÄÄ°ÅTÄ°RME (BULK UPDATE) ---
        function renderBulkUpdateModule() {
            setActiveTab('showBulkUpdate');
            loadModule(`
                <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ’¸ Toplu Fiyat DeÄŸiÅŸtirme</h2>
                <div class="p-6 bg-white rounded-lg shadow-md max-w-2xl">
                    <p class="mb-4 text-gray-600">AÅŸaÄŸÄ±daki listede Ã¼rÃ¼nlerin mevcut fiyatlarÄ±nÄ± deÄŸiÅŸtirebilir veya Toplu DeÄŸiÅŸim araÃ§larÄ±nÄ± kullanabilirsiniz. **Yeni fiyatlarÄ± manuel olarak sÄ±ra sÄ±ra da girebilirsiniz.**</p>
                    
                    <div class="border p-4 mb-6 rounded-lg bg-gray-50">
                        <h3 class="font-bold mb-3 text-orange-600">Toplu DeÄŸiÅŸim AraÃ§larÄ±</h3>
                        <label class="block mb-2 font-semibold text-sm">Uygulanacak Kategori:</label>
                        <select id="bulkCategory" class="border p-2 rounded w-full mb-3">
                            <option value="TÃ¼mÃ¼">TÃ¼m ÃœrÃ¼nler</option>
                            ${categoriesTR.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                        </select>

                        <label class="block mb-2 font-semibold text-sm">DeÄŸiÅŸim Tipi:</label>
                        <div class="flex gap-4 mb-3">
                            <label class="flex items-center"><input type="radio" name="updateType" value="percent" checked class="mr-2"> YÃ¼zdesel (%)</label>
                            <label class="flex items-center"><input type="radio" name="updateType" value="fixed" class="mr-2"> Sabit DeÄŸer (â‚º)</label>
                        </div>

                        <input id="updateValue" type="number" placeholder="Ã–rn: 10 (â‚º10 artÄ±ÅŸ) veya -5 (%5 indirim)" class="border p-2 rounded w-full mb-4" />
                        
                        <button id="applyBulkAdjustment" class="bg-blue-500 text-white px-4 py-2 rounded font-semibold hover:bg-blue-600 transition w-full">SeÃ§ili ÃœrÃ¼nlere Toplu Ayar Uygula</button>
                    </div>

                    <h3 class="font-bold text-xl mb-3 text-gray-800">ÃœrÃ¼n FiyatlarÄ±nÄ± Manuel DÃ¼zenle</h3>
                    <div class="flex font-bold text-sm bg-gray-100 p-2 rounded mb-2">
                        <span class="w-1/2">ÃœrÃ¼n AdÄ±</span>
                        <span class="w-1/4 text-right">Mevcut Fiyat</span>
                        <span class="w-1/4 text-right">Yeni Fiyat (â‚º)</span>
                    </div>
                    <form id="bulkUpdateForm" class="flex flex-col gap-2">
                        <p class="text-gray-500">ÃœrÃ¼nler yÃ¼kleniyor...</p>
                        </form>
                    
                    <button id="saveManualPrices" class="mt-6 bg-red-500 text-white px-4 py-3 rounded text-lg font-semibold hover:bg-red-600 transition w-full">GirdiÄŸim Yeni FiyatlarÄ± Kaydet</button>
                    <p id="bulkStatus" class="mt-4 text-center text-sm text-green-600 hidden"></p>
                </div>
            `);

            // Event Listener'lar
            document.getElementById('bulkCategory').addEventListener('change', () => renderBulkPriceList(document.getElementById('bulkCategory').value));
            document.getElementById('applyBulkAdjustment').addEventListener('click', applyBulkAdjustment);
            document.getElementById('saveManualPrices').addEventListener('click', saveManualPrices);
            
            renderBulkPriceList(document.getElementById('bulkCategory').value);
        }
        
        // Toplu fiyat listesini dÃ¼zenlenebilir inputlarla render eder
        function renderBulkPriceList(filter='TÃ¼mÃ¼') {
            const formEl = document.getElementById('bulkUpdateForm');
            if (!formEl) return;
            formEl.innerHTML = '';
            
            const sortedProducts = sortProductsByOrder([...products]);

            const filtered = filter === 'TÃ¼mÃ¼' ? sortedProducts : sortedProducts.filter(p => p.category === filter);

            if (filtered.length === 0) {
                formEl.innerHTML = '<p class="p-4 bg-white rounded shadow text-gray-500">Bu kategoride Ã¼rÃ¼n bulunmamaktadÄ±r.</p>';
                return;
            }

            filtered.forEach(p => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center bg-white p-2 rounded border text-sm';
                item.innerHTML = `
                    <span class="w-1/2">${p.name}</span>
                    <span class="w-1/4 text-right font-medium">${p.price} â‚º</span>
                    <input 
                        type="number" 
                        step="1" 
                        placeholder="${p.price}" 
                        value="${p.price}"
                        data-key="${p.key}" 
                        class="bulk-price-input w-1/4 text-right border p-1 rounded focus:border-orange-500"
                    />
                `;
                formEl.appendChild(item);
            });
        }

        // Toplu yÃ¼zdesel/sabit ayarÄ± input alanlarÄ±na uygular
        function applyBulkAdjustment() {
            const updateType = document.querySelector('input[name="updateType"]:checked').value;
            const value = parseFloat(document.getElementById('updateValue').value);
            const statusEl = document.getElementById('bulkStatus');
            statusEl.classList.add('hidden');

            if (isNaN(value) || value === 0) {
                statusEl.textContent = 'LÃ¼tfen geÃ§erli bir deÄŸiÅŸim deÄŸeri girin.';
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-green-600');
                statusEl.classList.add('text-red-600');
                return;
            }

            const inputs = document.querySelectorAll('#bulkUpdateForm .bulk-price-input');
            let updatedCount = 0;

            inputs.forEach(input => {
                const productKey = input.dataset.key;
                const currentProduct = products.find(p => p.key === productKey);
                if (!currentProduct) return;

                let newPrice;
                const basePrice = currentProduct.price; 

                if (updateType === 'percent') {
                    newPrice = basePrice * (1 + (value / 100));
                } else { // fixed
                    newPrice = basePrice + value;
                }
                newPrice = Math.max(0, parseFloat(newPrice.toFixed(2)));
                
                input.value = newPrice;
                updatedCount++;
            });

            if (updatedCount > 0) {
                statusEl.textContent = `${updatedCount} Ã¼rÃ¼nÃ¼n fiyatÄ± gÃ¼ncellendi. LÃ¼tfen "Kaydet" butonuna basarak deÄŸiÅŸiklikleri veritabanÄ±na iÅŸleyin.`;
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-red-600');
                statusEl.classList.add('text-green-600');
            } else {
                 statusEl.textContent = 'GÃ¼ncellenecek Ã¼rÃ¼n bulunamadÄ±.';
                 statusEl.classList.remove('hidden');
                 statusEl.classList.remove('text-green-600');
                 statusEl.classList.add('text-red-600');
            }
        }


        // Manuel girilen fiyatlarÄ± Firebase'e kaydeder
        async function saveManualPrices() {
            const inputs = document.querySelectorAll('#bulkUpdateForm .bulk-price-input');
            const updates = {};
            const currentTime = Date.now();
            const statusEl = document.getElementById('bulkStatus');
            let changesMade = 0;

            if (inputs.length === 0) {
                statusEl.textContent = 'Kaydedilecek Ã¼rÃ¼n bulunamadÄ±.';
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-green-600');
                statusEl.classList.add('text-red-600');
                return;
            }

            for (const input of inputs) {
                const productKey = input.dataset.key;
                const newPrice = parseFloat(input.value);
                const currentProduct = products.find(p => p.key === productKey);

                if (isNaN(newPrice) || newPrice < 0) {
                    alert(`${currentProduct.name} Ã¼rÃ¼nÃ¼ iÃ§in geÃ§ersiz fiyat girdiniz. LÃ¼tfen kontrol edin.`);
                    return; 
                }
                
                if (currentProduct && currentProduct.price !== newPrice) {
                    updates[`products/${productKey}/price`] = newPrice;
                    updates[`products/${productKey}/lastUpdated`] = currentTime; 
                    changesMade++;
                }
            }


            if (changesMade === 0) {
                statusEl.textContent = 'Herhangi bir fiyat deÄŸiÅŸikliÄŸi tespit edilmedi.';
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-red-600');
                statusEl.classList.add('text-green-600');
                return;
            }
            
            if (!confirm(`${changesMade} Ã¼rÃ¼nÃ¼n fiyatÄ± gÃ¼ncellenecektir. OnaylÄ±yor musunuz?`)) {
                return;
            }

            try {
                await database.ref().update(updates); 
                statusEl.textContent = `${changesMade} Ã¼rÃ¼n fiyatÄ± baÅŸarÄ±yla kaydedildi ve ana menÃ¼ gÃ¼ncellendi.`;
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-red-600');
                statusEl.classList.add('text-green-600');
                // Fiyatlar gÃ¼ncellendiÄŸi iÃ§in listeyi yeniden render et
                renderBulkPriceList(document.getElementById('bulkCategory').value);
            } catch (error) {
                statusEl.textContent = 'FiyatlarÄ± kaydetme baÅŸarÄ±sÄ±z oldu: ' + error.message;
                statusEl.classList.remove('hidden');
                statusEl.classList.remove('text-green-600');
                statusEl.classList.add('text-red-600');
            }
        }
        
        // --- MODÃœL: Ä°STATÄ°STÄ°KLER (STATS) ---
        function renderStatsModule() {
            setActiveTab('showStats');
            loadModule(`
                <h2 class="text-3xl font-bold text-gray-800 mb-6">ğŸ“Š Ä°statistikler</h2>
                <div class="grid grid-cols-2 gap-6 max-w-xl">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-2 text-orange-600">BugÃ¼nkÃ¼ GÃ¶rÃ¼ntÃ¼leme</h3>
                        <p id="todayCount" class="text-4xl font-bold text-gray-800">0</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-2 text-orange-600">Toplam GÃ¶rÃ¼ntÃ¼leme</h3>
                        <p id="totalCount" class="text-4xl font-bold text-gray-800">0</p>
                    </div>
                </div>
                <div class="mt-8">
                    <button id="resetCounter" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition">SayaÃ§larÄ± SÄ±fÄ±rla (Manuel)</button>
                    <p class="text-sm text-gray-500 mt-2">NOT: GÃ¼nlÃ¼k sayaÃ§ Firebase'de gÃ¼n bazÄ±nda tutulur. Bu buton tÃ¼m sayaÃ§ geÃ§miÅŸini siler.</p>
                </div>
            `);
            fetchVisitorCounts();
            document.getElementById('resetCounter').addEventListener('click', resetVisitorCounts);
        }

        function fetchVisitorCounts() {
            const today = new Date().toISOString().slice(0, 10);
            
            visitorsRef.child(today).once('value', snapshot => {
                document.getElementById('todayCount').textContent = snapshot.val() || 0;
            });

            visitorsRef.once('value', snapshot => {
                let total = 0;
                snapshot.forEach(child => {
                    total += child.val();
                });
                document.getElementById('totalCount').textContent = total;
            });
        }
        
        async function resetVisitorCounts() {
            if (confirm("TÃ¼m ziyaretÃ§i verilerini sÄ±fÄ±rlamak istediÄŸinizden emin misiniz? Bu iÅŸlem geri alÄ±namaz.")) {
                try {
                    await visitorsRef.remove();
                    alert("ZiyaretÃ§i sayaÃ§larÄ± baÅŸarÄ±yla sÄ±fÄ±rlandÄ±.");
                    fetchVisitorCounts(); 
                } catch (error) {
                    alert("SayaÃ§ sÄ±fÄ±rlama baÅŸarÄ±sÄ±z oldu: " + error.message);
                }
            }
        }

        // --- EDÄ°T MODAL ORTAK KULLANIM FONKSÄ°YONLARI ---
        function openEditModal(productKey) {
            const productToEdit = products.find(p => p.key === productKey);
            
            if (productToEdit) {
                document.getElementById('editProductKey').value = productKey; 
                document.getElementById('editName').value = productToEdit.name;
                document.getElementById('editNameEN').value = productToEdit.nameEN || '';
                document.getElementById('editDesc').value = productToEdit.desc || '';
                document.getElementById('editDescEN').value = productToEdit.descEN || '';
                document.getElementById('editPrice').value = productToEdit.price;
                
                const editCategorySelect = document.getElementById('editCategory');
                editCategorySelect.innerHTML = categoriesTR.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                editCategorySelect.value = productToEdit.category;
                
                editImageURLInput.value = productToEdit.image;
                editImagePreview.src = productToEdit.image;
                
                editProductModal.classList.remove('hidden');
            }
        }


        // --- GENEL EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // BaÅŸlangÄ±Ã§ta ÃœrÃ¼n YÃ¶netimi modÃ¼lÃ¼nÃ¼ yÃ¼kle
            renderProductsModule();
            
            // Firebase Dinleyicisi (ÃœrÃ¼nler)
            productsRef.on('value', (snapshot) => {
                products = [];
                snapshot.forEach(childSnapshot => {
                    const product = childSnapshot.val();
                    product.key = childSnapshot.key;
                    products.push(product);
                });
                
                const activeTab = document.querySelector('.tab-button.active');
                if (activeTab) {
                    const activeId = activeTab.id;
                    
                    if (activeId === 'showProducts') {
                        const filterSelect = document.getElementById('filterCategory');
                        if (filterSelect) renderProductList(filterSelect.value);
                    } else if (activeId === 'showBulkUpdate') {
                        const bulkSelect = document.getElementById('bulkCategory');
                        if (bulkSelect) renderBulkPriceList(bulkSelect.value);
                    } else if (activeId === 'showSorting') {
                        const sortSelect = document.getElementById('sortCategory');
                        if (sortSelect && sortSelect.value) loadSortableList(sortSelect.value);
                    }
                }
            });

            // Firebase Dinleyicisi (Kampanya GÃ¶rselleri)
            campaignsRef.on('value', (snapshot) => {
                 campaignUrls = [];
                 snapshot.forEach(childSnapshot => {
                     const campaign = childSnapshot.val();
                     campaign.key = childSnapshot.key;
                     campaignUrls.push(campaign);
                 });
                 if (document.getElementById('campaignList')) {
                     renderCampaignList();
                 }
            });
            
            // Firebase Dinleyicisi (Kampanya Fiyat Metni)
            campaignInfoRef.child('price_text').on('value', (snapshot) => {
                 campaignPriceText = snapshot.val() || "";
                 const inputEl = document.getElementById('campaignPriceTextInput');
                 if(inputEl) {
                     inputEl.value = campaignPriceText;
                 }
            });
            
            // YENÄ°: Firebase Dinleyicisi (Fiyat KutucuÄŸu GÃ¶rseli URL'si)
            priceBoxUrlRef.on('value', (snapshot) => {
                 campaignPriceBoxUrl = snapshot.val() || "";
                 const inputEl = document.getElementById('priceBoxImageURL');
                 const previewEl = document.getElementById('priceBoxImagePreview');
                 if(inputEl) {
                     inputEl.value = campaignPriceBoxUrl;
                 }
                 if(previewEl) {
                     previewEl.src = campaignPriceBoxUrl;
                     if(campaignPriceBoxUrl) {
                        previewEl.classList.remove('hidden');
                     } else {
                        previewEl.classList.add('hidden');
                     }
                 }
            });


            // Navigasyon ButonlarÄ±
            showProductsBtn.addEventListener('click', renderProductsModule);
            showSortingBtn.addEventListener('click', renderSortingModule); 
            showCampaignsBtn.addEventListener('click', renderCampaignModule); 
            showAddProductBtn.addEventListener('click', renderAddProductModule);
            showBulkUpdateBtn.addEventListener('click', renderBulkUpdateModule);
            showStatsBtn.addEventListener('click', renderStatsModule);
            
            // Edit Modal ButonlarÄ±
            closeEditProductModal.addEventListener('click', () => editProductModal.classList.add('hidden'));
            uploadEditImageBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openCloudinaryWidget(editImageURLInput, editImagePreview);
            });
            saveEditProductButton.addEventListener('click', async () => {
                const productKey = document.getElementById('editProductKey').value;
                const updates = {
                    name: document.getElementById('editName').value.trim(),
                    nameEN: document.getElementById('editNameEN').value.trim(),
                    desc: document.getElementById('editDesc').value.trim(),
                    descEN: document.getElementById('editDescEN').value.trim(),
                    price: parseFloat(document.getElementById('editPrice').value),
                    category: document.getElementById('editCategory').value,
                    image: editImageURLInput.value.trim()
                };
                
                if (isNaN(updates.price)) { alert('LÃ¼tfen geÃ§erli bir fiyat giriniz.'); return; }

                try {
                    if (!updates.image) updates.image = ''; 

                    await updateProductInFirebase(productKey, updates); 
                    editProductModal.classList.add('hidden');
                    alert(`"${updates.name}" Ã¼rÃ¼nÃ¼ baÅŸarÄ±yla gÃ¼ncellendi.`);
                } catch (error) {
                    alert("GÃ¼ncelleme iÅŸlemi baÅŸarÄ±sÄ±z oldu: " + error.message);
                }
            });
        });
    </script>
</body>
</html>
